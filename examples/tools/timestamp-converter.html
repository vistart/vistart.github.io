<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间戳转换工具</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as SVG components
        const Clock = () => (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></circle>
                <path d="M12 6v6l4 2" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M21 2v6h-6M3 12a9 9 0 0115-6.7L21 8M3 22v-6h6M21 12a9 9 0 01-15 6.7L3 16" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
            </svg>
        );

        const Calendar = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" strokeWidth="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6" strokeWidth="2" strokeLinecap="round"></line>
                <line x1="8" y1="2" x2="8" y2="6" strokeWidth="2" strokeLinecap="round"></line>
                <line x1="3" y1="10" x2="21" y2="10" strokeWidth="2"></line>
            </svg>
        );

        const Zap = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></polygon>
            </svg>
        );

        function TimestampConverter() {
            const [timestamp, setTimestamp] = useState('');
            const [isoString, setIsoString] = useState('');
            const [timezone, setTimezone] = useState('UTC');
            const [precision, setPrecision] = useState('milliseconds');
            const [autoUpdate, setAutoUpdate] = useState(false);
            const [lastUpdate, setLastUpdate] = useState(Date.now());

            // 精度配置
            const precisionConfig = {
                seconds: { multiplier: 1, decimals: 0, label: '秒' },
                milliseconds: { multiplier: 1000, decimals: 0, label: '毫秒' },
                microseconds: { multiplier: 1000000, decimals: 0, label: '微秒' },
                nanoseconds: { multiplier: 1000000000, decimals: 0, label: '纳秒' }
            };

            // 获取所有可用时区
            const timezones = Intl.supportedValuesOf('timeZone');

            // 自动更新当前时间
            useEffect(() => {
                let interval;
                if (autoUpdate) {
                    interval = setInterval(() => {
                        setLastUpdate(Date.now());
                        updateFromCurrentTime();
                    }, 100);
                }
                return () => {
                    if (interval) clearInterval(interval);
                };
            }, [autoUpdate, precision, timezone]);

            // 从当前时间更新
            const updateFromCurrentTime = () => {
                const now = Date.now();
                const config = precisionConfig[precision];
                const ts = Math.floor(now * config.multiplier / 1000);
                setTimestamp(ts.toString());
                
                const date = new Date(now);
                const iso = formatDateToTimezone(date, timezone);
                setIsoString(iso);
            };

            // 格式化日期到指定时区
            const formatDateToTimezone = (date, tz) => {
                try {
                    if (tz === 'UTC') {
                        return date.toISOString();
                    } else {
                        const options = {
                            timeZone: tz,
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            fractionalSecondDigits: 3,
                            hour12: false
                        };
                        
                        const formatter = new Intl.DateTimeFormat('en-CA', options);
                        const parts = formatter.formatToParts(date);
                        
                        const getValue = (type) => parts.find(p => p.type === type)?.value || '';
                        
                        const year = getValue('year');
                        const month = getValue('month');
                        const day = getValue('day');
                        const hour = getValue('hour');
                        const minute = getValue('minute');
                        const second = getValue('second');
                        const ms = date.getMilliseconds().toString().padStart(3, '0');
                        
                        // 获取时区偏移
                        const tzOffset = getTimezoneOffset(date, tz);
                        
                        return `${year}-${month}-${day}T${hour}:${minute}:${second}.${ms}${tzOffset}`;
                    }
                } catch (e) {
                    return date.toISOString();
                }
            };

            // 获取时区偏移字符串
            const getTimezoneOffset = (date, tz) => {
                try {
                    const utcDate = new Date(date.toLocaleString('en-US', { timeZone: 'UTC' }));
                    const tzDate = new Date(date.toLocaleString('en-US', { timeZone: tz }));
                    const offset = (tzDate.getTime() - utcDate.getTime()) / 60000;
                    
                    const hours = Math.floor(Math.abs(offset) / 60);
                    const minutes = Math.abs(offset) % 60;
                    const sign = offset >= 0 ? '+' : '-';
                    
                    return `${sign}${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                } catch (e) {
                    return '+00:00';
                }
            };

            // 时间戳转ISO
            const handleTimestampChange = (value) => {
                setTimestamp(value);
                if (!value || isNaN(value)) {
                    setIsoString('');
                    return;
                }

                try {
                    const config = precisionConfig[precision];
                    const msTimestamp = parseFloat(value) / config.multiplier * 1000;
                    const date = new Date(msTimestamp);
                    
                    if (isNaN(date.getTime())) {
                        setIsoString('无效的时间戳');
                        return;
                    }

                    const iso = formatDateToTimezone(date, timezone);
                    setIsoString(iso);
                } catch (e) {
                    setIsoString('转换错误');
                }
            };

            // ISO转时间戳
            const handleIsoChange = (value) => {
                setIsoString(value);
                if (!value) {
                    setTimestamp('');
                    return;
                }

                try {
                    let date;
                    
                    // 如果没有时区信息，默认为UTC
                    if (!value.includes('Z') && !value.match(/[+-]\d{2}:\d{2}$/)) {
                        date = new Date(value + 'Z');
                    } else {
                        date = new Date(value);
                    }

                    if (isNaN(date.getTime())) {
                        setTimestamp('无效的ISO格式');
                        return;
                    }

                    const config = precisionConfig[precision];
                    const ts = Math.floor(date.getTime() * config.multiplier / 1000);
                    setTimestamp(ts.toString());
                } catch (e) {
                    setTimestamp('转换错误');
                }
            };

            // 获取当前时间
            const getCurrentTime = () => {
                updateFromCurrentTime();
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-8">
                            {/* 标题 */}
                            <div className="flex items-center gap-3 mb-8">
                                <div className="text-indigo-600">
                                    <Clock />
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800">时间戳转换工具</h1>
                            </div>

                            {/* 控制面板 */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 p-4 bg-gray-50 rounded-lg">
                                {/* 精度选择 */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        时间精度
                                    </label>
                                    <select
                                        value={precision}
                                        onChange={(e) => {
                                            setPrecision(e.target.value);
                                            if (timestamp) {
                                                const config = precisionConfig[e.target.value];
                                                const oldConfig = precisionConfig[precision];
                                                const newTs = Math.floor(parseFloat(timestamp) * oldConfig.multiplier / config.multiplier);
                                                setTimestamp(newTs.toString());
                                            }
                                        }}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    >
                                        {Object.entries(precisionConfig).map(([key, { label }]) => (
                                            <option key={key} value={key}>{label}</option>
                                        ))}
                                    </select>
                                </div>

                                {/* 时区选择 */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        时区
                                    </label>
                                    <select
                                        value={timezone}
                                        onChange={(e) => {
                                            setTimezone(e.target.value);
                                            if (timestamp && !isNaN(timestamp)) {
                                                const config = precisionConfig[precision];
                                                const msTimestamp = parseFloat(timestamp) / config.multiplier * 1000;
                                                const date = new Date(msTimestamp);
                                                setIsoString(formatDateToTimezone(date, e.target.value));
                                            }
                                        }}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    >
                                        {timezones.map(tz => (
                                            <option key={tz} value={tz}>{tz}</option>
                                        ))}
                                    </select>
                                </div>

                                {/* 当前时间控制 */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        当前时间
                                    </label>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={getCurrentTime}
                                            className="flex-1 px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center justify-center gap-2"
                                        >
                                            <RefreshCw className="w-4 h-4" />
                                            获取
                                        </button>
                                        <button
                                            onClick={() => setAutoUpdate(!autoUpdate)}
                                            className={`flex-1 px-3 py-2 rounded-lg transition flex items-center justify-center gap-2 ${
                                                autoUpdate 
                                                    ? 'bg-green-600 text-white hover:bg-green-700' 
                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }`}
                                        >
                                            <Zap className="w-4 h-4" />
                                            {autoUpdate ? '跟随中' : '自动'}
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {/* 转换区域 */}
                            <div className="space-y-6">
                                {/* 时间戳输入 */}
                                <div className="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl">
                                    <label className="block text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <Calendar className="w-5 h-5 text-indigo-600" />
                                        时间戳 ({precisionConfig[precision].label})
                                    </label>
                                    <input
                                        type="text"
                                        value={timestamp}
                                        onChange={(e) => handleTimestampChange(e.target.value)}
                                        placeholder={`输入时间戳 (${precisionConfig[precision].label})`}
                                        className="w-full px-4 py-3 text-lg border-2 border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    />
                                    <p className="mt-2 text-sm text-gray-600">
                                        示例: {Math.floor(Date.now() * precisionConfig[precision].multiplier / 1000)}
                                    </p>
                                </div>

                                {/* 双向箭头 */}
                                <div className="flex justify-center">
                                    <div className="bg-white p-3 rounded-full shadow-md">
                                        <svg className="w-6 h-6 text-indigo-600" fill="none" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" viewBox="0 0 24 24" stroke="currentColor">
                                            <path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                                        </svg>
                                    </div>
                                </div>

                                {/* ISO格式输入 */}
                                <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl">
                                    <label className="block text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <Clock />
                                        ISO 8601 格式 ({timezone})
                                    </label>
                                    <input
                                        type="text"
                                        value={isoString}
                                        onChange={(e) => handleIsoChange(e.target.value)}
                                        placeholder="输入ISO格式时间，如 2024-01-01T00:00:00Z"
                                        className="w-full px-4 py-3 text-lg border-2 border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    />
                                    <p className="mt-2 text-sm text-gray-600">
                                        示例: {formatDateToTimezone(new Date(), timezone)}
                                    </p>
                                </div>
                            </div>

                            {/* 说明 */}
                            <div className="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <h3 className="font-semibold text-blue-900 mb-2">使用说明</h3>
                                <ul className="text-sm text-blue-800 space-y-1">
                                    <li>• 支持双向转换：时间戳 ↔ ISO 8601格式</li>
                                    <li>• ISO格式不指定时区时默认为UTC，可手动选择其他时区</li>
                                    <li>• 支持秒、毫秒、微秒、纳秒四种精度</li>
                                    <li>• 点击"获取"按钮获取当前时间，点击"自动"开启实时跟随</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TimestampConverter />, document.getElementById('root'));
    </script>
</body>
</html>
