<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformerä½ç½®ç¼–ç å¯¹æ¯”æ¼”ç¤º - å®Œæ•´ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8fafc;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #1a202c;
            margin-bottom: 16px;
        }
        
        .header p {
            color: #718096;
            max-width: 700px;
            margin: 0 auto;
            font-size: 1.1rem;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .tabs-container {
            background: #e2e8f0;
            padding: 4px;
            border-radius: 8px;
        }
        
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab-button.traditional.active {
            color: #e53e3e;
        }
        
        .tab-button.rope.active {
            color: #38a169;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #4299e1;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #3182ce;
        }
        
        .btn-secondary {
            background: #718096;
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #4a5568;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .token-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .token-selector select {
            border: none;
            background: transparent;
            font-weight: 600;
        }
        
        .progress-container {
            margin-bottom: 30px;
            text-align: center;
        }
        
        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: all 0.3s;
        }
        
        .progress-dot.active {
            background: #4299e1;
        }
        
        .demo-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .demo-header {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .demo-header.traditional {
            background: #fed7d7;
            border: 1px solid #feb2b2;
        }
        
        .demo-header.rope {
            background: #c6f6d5;
            border: 1px solid #9ae6b4;
        }
        
        .demo-header h3 {
            font-size: 1.25rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .demo-header.traditional h3 {
            color: #c53030;
        }
        
        .demo-header.rope h3 {
            color: #2f855a;
        }
        
        .step-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .step-content h4 {
            font-size: 1.1rem;
            margin-bottom: 16px;
            color: #2d3748;
        }
        
        .step-description {
            background: #f7fafc;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4299e1;
        }
        
        .matrix-display {
            background: #f8f9fa;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .matrix-display.highlight {
            background: #ebf8ff;
            border-color: #90cdf4;
        }
        
        .matrix-title {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }
        
        .matrix-content {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .token-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .token-label {
            width: 80px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .token-values {
            flex: 1;
            color: #4a5568;
        }
        
        .formula-box {
            background: #f1f5f9;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
        }
        
        .formula-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .angle-visualization {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
            border: 1px solid #e2e8f0;
            border-radius: 50%;
            background: #f8f9fa;
        }
        
        .angle-line {
            position: absolute;
            width: 80px;
            height: 2px;
            top: 50%;
            left: 50%;
            transform-origin: 0 50%;
            transition: transform 0.5s ease;
        }
        
        .angle-line.traditional {
            background: #e53e3e;
        }
        
        .angle-line.rope {
            background: #38a169;
        }
        
        .angle-center {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #2d3748;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .angle-label {
            position: absolute;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .angle-label.traditional {
            color: #e53e3e;
        }
        
        .angle-label.rope {
            color: #38a169;
        }
        
        .comparison-panel {
            background: #fff8e1;
            border: 1px solid #ffcc02;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .comparison-title {
            font-weight: 600;
            color: #b7791f;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .comparison-item {
            background: white;
            padding: 16px;
            border-radius: 6px;
            border-left: 3px solid #ffcc02;
        }
        
        .two-token-demo {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .two-token-title {
            font-weight: 600;
            color: #2f855a;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .token-pair {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 16px 0;
        }
        
        .token-box {
            background: white;
            border: 2px solid #9ae6b4;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            min-width: 100px;
        }
        
        .token-name {
            font-weight: 600;
            color: #2d3748;
        }
        
        .token-pos {
            font-size: 0.9rem;
            color: #718096;
        }
        
        .arrow {
            font-size: 1.5rem;
            color: #38a169;
        }
        
        .relative-distance {
            background: #e6fffa;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .info-panel {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
        }
        
        .info-panel.warning {
            background: #fffaf0;
            border-color: #f6e05e;
        }
        
        .info-panel.success {
            background: #f0fff4;
            border-color: #9ae6b4;
        }
        
        .info-panel h4 {
            margin-bottom: 12px;
            font-size: 1rem;
        }
        
        .info-panel.warning h4 {
            color: #b7791f;
        }
        
        .info-panel.success h4 {
            color: #2f855a;
        }
        
        .info-list {
            list-style: none;
            font-size: 0.9rem;
        }
        
        .info-list li {
            margin-bottom: 8px;
            padding-left: 8px;
        }
        
        .info-panel.warning .info-list {
            color: #b7791f;
        }
        
        .info-panel.success .info-list {
            color: #2f855a;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .step-container,
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 16px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Transformerä½ç½®ç¼–ç å¯¹æ¯”æ¼”ç¤º</h1>
            <p>æ·±å…¥ç†è§£ä¼ ç»ŸTransformerå’ŒRoPE Transformeråœ¨ä½ç½®ç¼–ç å¤„ç†ä¸Šçš„æœ¬è´¨å·®å¼‚ï¼ŒåŒ…æ‹¬è¯åµŒå…¥è®¡ç®—ã€ä½ç½®ç¼–ç ç”Ÿæˆå’Œç›¸å¯¹ä½ç½®å…³ç³»å»ºæ¨¡</p>
        </div>

        <div class="tabs">
            <div class="tabs-container">
                <button class="tab-button traditional active" onclick="switchTab('traditional')">
                    ä¼ ç»ŸTransformer
                </button>
                <button class="tab-button rope" onclick="switchTab('rope')">
                    RoPE Transformer
                </button>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="startDemo()" id="startBtn">
                â–¶ï¸ å¼€å§‹æ¼”ç¤º
            </button>
            <button class="btn btn-secondary" onclick="resetDemo()" id="resetBtn">
                ğŸ”„ é‡ç½®
            </button>
            <div class="token-selector">
                <label>å…³æ³¨è¯å¯¹:</label>
                <select id="tokenPairSelect" onchange="updateTokenPair()">
                    <option value="0,1">çŒ« â†’ ååœ¨</option>
                    <option value="0,2">çŒ« â†’ å«å­</option>
                    <option value="0,3">çŒ« â†’ ä¸Š</option>
                    <option value="1,2">ååœ¨ â†’ å«å­</option>
                    <option value="1,3">ååœ¨ â†’ ä¸Š</option>
                    <option value="2,3">å«å­ â†’ ä¸Š</option>
                </select>
            </div>
        </div>

        <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-dots" id="progressDots"></div>
            <div id="progressText">æ­¥éª¤ 1 / 5</div>
        </div>

        <div class="demo-content">
            <!-- ä¼ ç»ŸTransformeræ¼”ç¤º -->
            <div id="traditionalDemo" class="demo-section">
                <div class="demo-header traditional">
                    <h3>ğŸ§  ä¼ ç»ŸTransformerå¤„ç†æµç¨‹</h3>
                    <p>åŸºäºä¸‰è§’å‡½æ•°çš„ç»å¯¹ä½ç½®ç¼–ç ï¼Œåœ¨è¾“å…¥å±‚èåˆåéšç½‘ç»œæ·±åº¦é€æ¸è¡°å‡</p>
                </div>

                <div class="step-container">
                    <div class="step-content">
                        <h4 id="traditionalStepTitle">æ­¥éª¤1: è¯åµŒå…¥è¡¨æŸ¥æ‰¾</h4>
                        <div class="step-description">
                            <div id="traditionalStepDescription">ä»é¢„è®­ç»ƒçš„è¯åµŒå…¥è¡¨ä¸­æŸ¥æ‰¾æ¯ä¸ªè¯çš„è¯­ä¹‰å‘é‡è¡¨ç¤º</div>
                        </div>
                        
                        <div id="traditionalCalculation"></div>
                        <div id="traditionalVisualization"></div>
                    </div>

                    <div class="info-panel warning">
                        <h4>âš ï¸ å…³é”®é—®é¢˜</h4>
                        <ul class="info-list">
                            <li>â€¢ ä½ç½®ä¿¡æ¯åœ¨è¾“å…¥é˜¶æ®µä¸€æ¬¡æ€§èåˆ</li>
                            <li>â€¢ éšç€ç½‘ç»œå±‚æ•°å¢åŠ é€æ¸ä¸¢å¤±</li>
                            <li>â€¢ æ·±å±‚ç½‘ç»œä¸»è¦ä¾èµ–è¯­ä¹‰ä¿¡æ¯</li>
                            <li>â€¢ åºåˆ—é•¿åº¦å—é¢„å®šä¹‰ä½ç½®è¡¨é™åˆ¶</li>
                            <li>â€¢ ç›¸å¯¹ä½ç½®å…³ç³»éœ€è¦é—´æ¥å­¦ä¹ </li>
                        </ul>
                    </div>
                </div>

                <div class="two-token-demo" id="traditionalTokenDemo">
                    <div class="two-token-title">ğŸ”— è¯å¯¹ç›¸å¯¹ä½ç½®åˆ†æ</div>
                    <div id="traditionalTokenPair"></div>
                </div>
            </div>

            <!-- RoPE Transformeræ¼”ç¤º -->
            <div id="ropeDemo" class="demo-section hidden">
                <div class="demo-header rope">
                    <h3>âš¡ RoPE Transformerå¤„ç†æµç¨‹</h3>
                    <p>åŸºäºå¤æ•°æ—‹è½¬çš„ç›¸å¯¹ä½ç½®ç¼–ç ï¼Œè¯­ä¹‰ä¸ä½ç½®å®Œå…¨åˆ†ç¦»ï¼Œæ¯å±‚åŠ¨æ€è®¡ç®—ä½ç½®å…³ç³»</p>
                </div>

                <div class="step-container">
                    <div class="step-content">
                        <h4 id="ropeStepTitle">æ­¥éª¤1: çº¯è¯åµŒå…¥æŸ¥æ‰¾</h4>
                        <div class="step-description">
                            <div id="ropeStepDescription">ä»…ä»è¯åµŒå…¥è¡¨è·å–è¯­ä¹‰ä¿¡æ¯ï¼Œä¿æŒä½ç½®ä¿¡æ¯çš„çº¯å‡€åˆ†ç¦»</div>
                        </div>
                        
                        <div id="ropeCalculation"></div>
                        <div id="ropeVisualization"></div>
                    </div>

                    <div class="info-panel success">
                        <h4>âœ… æ ¸å¿ƒä¼˜åŠ¿</h4>
                        <ul class="info-list">
                            <li>â€¢ è¯­ä¹‰ä¸ä½ç½®ä¿¡æ¯å®Œå…¨åˆ†ç¦»</li>
                            <li>â€¢ æ¯å±‚é‡æ–°è®¡ç®—ä½ç½®å…³ç³»</li>
                            <li>â€¢ ä½ç½®ç²¾åº¦æ°¸è¿œä¿æŒ100%</li>
                            <li>â€¢ æ”¯æŒä»»æ„é•¿åº¦åºåˆ—å¤„ç†</li>
                            <li>â€¢ åŸºäºæ•°å­¦å…¬å¼ï¼Œæ— å‚æ•°å¼€é”€</li>
                            <li>â€¢ ç›´æ¥å»ºæ¨¡ç›¸å¯¹ä½ç½®å…³ç³»</li>
                        </ul>
                    </div>
                </div>

                <div class="two-token-demo" id="ropeTokenDemo">
                    <div class="two-token-title">ğŸ”— è¯å¯¹ç›¸å¯¹ä½ç½®åˆ†æ</div>
                    <div id="ropeTokenPair"></div>
                </div>
            </div>
        </div>

        <div class="comparison-panel">
            <div class="comparison-title">
                âš–ï¸ æ ¸å¿ƒå·®å¼‚å¯¹æ¯”
            </div>
            <div class="comparison-grid">
                <div class="comparison-item">
                    <h4 style="color: #c53030; margin-bottom: 8px;">ä¼ ç»ŸTransformer</h4>
                    <div style="font-size: 0.9rem;">
                        â€¢ ä½¿ç”¨sin/cosä¸‰è§’å‡½æ•°ç”Ÿæˆä½ç½®ç¼–ç <br>
                        â€¢ ä½ç½®ä¿¡æ¯ä¸è¯­ä¹‰ä¿¡æ¯è¾“å…¥æ—¶èåˆ<br>
                        â€¢ ä½ç½®ä¿¡æ¯éšå±‚æ•°å¢åŠ è€Œè¡°å‡<br>
                        â€¢ åºåˆ—é•¿åº¦å—é¢„è®­ç»ƒé™åˆ¶
                    </div>
                </div>
                <div class="comparison-item">
                    <h4 style="color: #2f855a; margin-bottom: 8px;">RoPE Transformer</h4>
                    <div style="font-size: 0.9rem;">
                        â€¢ ä½¿ç”¨å¤æ•°æ—‹è½¬è¡¨ç¤ºä½ç½®å…³ç³»<br>
                        â€¢ ä½ç½®ä¿¡æ¯åœ¨æ³¨æ„åŠ›å±‚åŠ¨æ€è®¡ç®—<br>
                        â€¢ æ¯å±‚ä½ç½®ä¿¡æ¯ç²¾åº¦ä¿æŒ100%<br>
                        â€¢ æ”¯æŒä»»æ„é•¿åº¦åºåˆ—å¤„ç†
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        var currentTab = 'traditional';
        var isRunning = false;
        var currentStep = 0;
        var selectedTokenPair = [0, 1];

        // ç¤ºä¾‹æ•°æ® - å¥å­ "çŒ«ååœ¨å«å­ä¸Š"
        var tokens = ["çŒ«", "ååœ¨", "å«å­", "ä¸Š"];
        var vocab = {"çŒ«": 0, "ååœ¨": 1, "å«å­": 2, "ä¸Š": 3};
        
        // æ¨¡æ‹Ÿçš„è¯åµŒå…¥å‘é‡ (ç®€åŒ–ä¸º4ç»´ä¾¿äºå±•ç¤º)
        var tokenEmbeddings = [
            [0.2, 0.5, -0.1, 0.8],   // çŒ«
            [0.1, -0.3, 0.6, 0.2],   // ååœ¨  
            [-0.4, 0.7, 0.3, -0.2],  // å«å­
            [0.6, 0.1, -0.5, 0.4]    // ä¸Š
        ];

        // ä¼ ç»ŸTransformeræ¼”ç¤ºæ­¥éª¤
        var traditionalSteps = [
            {
                title: "è¯åµŒå…¥è¡¨æŸ¥æ‰¾",
                description: "ä»é¢„è®­ç»ƒçš„è¯åµŒå…¥è¡¨ä¸­æŸ¥æ‰¾æ¯ä¸ªè¯çš„è¯­ä¹‰å‘é‡è¡¨ç¤º",
                showEmbedding: true
            },
            {
                title: "ç»å¯¹ä½ç½®ç¼–ç è®¡ç®—", 
                description: "ä½¿ç”¨sin/cosä¸‰è§’å‡½æ•°ä¸ºæ¯ä¸ªä½ç½®ç”Ÿæˆå›ºå®šçš„ä½ç½®ç¼–ç ",
                showPositional: true
            },
            {
                title: "è¾“å…¥èåˆ",
                description: "å°†è¯åµŒå…¥ä¸ä½ç½®ç¼–ç ç›¸åŠ ï¼Œå½¢æˆåŒ…å«è¯­ä¹‰å’Œä½ç½®çš„æ··åˆè¡¨ç¤º",
                showFusion: true
            },
            {
                title: "å¤šå±‚å¤„ç†",
                description: "é€šè¿‡å¤šä¸ªTransformerå±‚å¤„ç†ï¼Œä½ç½®ä¿¡æ¯é€æ¸è¡°å‡",
                showDecay: true
            },
            {
                title: "æ³¨æ„åŠ›è®¡ç®—",
                description: "åŸºäºèåˆè¡¨ç¤ºè®¡ç®—æ³¨æ„åŠ›ï¼Œç›¸å¯¹ä½ç½®å…³ç³»éœ€è¦é—´æ¥å­¦ä¹ ",
                showAttention: true
            }
        ];

        // RoPE Transformeræ¼”ç¤ºæ­¥éª¤  
        var ropeSteps = [
            {
                title: "çº¯è¯åµŒå…¥æŸ¥æ‰¾",
                description: "ä»…ä»è¯åµŒå…¥è¡¨è·å–è¯­ä¹‰ä¿¡æ¯ï¼Œä¿æŒä½ç½®ä¿¡æ¯çš„çº¯å‡€åˆ†ç¦»",
                showEmbedding: true
            },
            {
                title: "RoPEé¢‘ç‡é¢„è®¡ç®—",
                description: "åŸºäºæ•°å­¦å…¬å¼è®¡ç®—æ—‹è½¬é¢‘ç‡ï¼Œæ”¯æŒä»»æ„é•¿åº¦åºåˆ—",
                showFrequency: true
            },
            {
                title: "ä½ç½®è§’åº¦è®¡ç®—",
                description: "ä¸ºæ¯ä¸ªä½ç½®è®¡ç®—å¯¹åº”çš„æ—‹è½¬è§’åº¦ï¼Œè§’åº¦åœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­ä¿æŒä¸€è‡´",
                showAngles: true
            },
            {
                title: "åŠ¨æ€æ—‹è½¬ç¼–ç ",
                description: "åœ¨æ³¨æ„åŠ›è®¡ç®—æ—¶å¯¹Qã€Kå‘é‡åº”ç”¨æ—‹è½¬å˜æ¢",
                showRotation: true
            },
            {
                title: "ç›¸å¯¹ä½ç½®æ³¨æ„åŠ›",
                description: "ç›´æ¥ä»æ—‹è½¬åçš„å‘é‡è®¡ç®—ç›¸å¯¹ä½ç½®å…³ç³»ï¼Œç²¾åº¦å§‹ç»ˆ100%",
                showRelativeAttention: true
            }
        ];

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tab) {
            currentTab = tab;
            
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
            var buttons = document.querySelectorAll('.tab-button');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            document.querySelector('.tab-button.' + tab).classList.add('active');
            
            // åˆ‡æ¢æ¼”ç¤ºå†…å®¹
            document.getElementById('traditionalDemo').classList.toggle('hidden', tab !== 'traditional');
            document.getElementById('ropeDemo').classList.toggle('hidden', tab !== 'rope');
            
            // é‡ç½®çŠ¶æ€
            resetDemo();
        }

        // æ›´æ–°é€‰ä¸­çš„è¯å¯¹
        function updateTokenPair() {
            var select = document.getElementById('tokenPairSelect');
            var value = select.value;
            selectedTokenPair = value.split(',').map(Number);
            
            // å¦‚æœæ­£åœ¨æ¼”ç¤ºä¸­ï¼Œæ›´æ–°è¯å¯¹æ˜¾ç¤º
            if (currentStep > 0) {
                updateTokenPairDisplay();
            }
        }

        // å¼€å§‹æ¼”ç¤º
        function startDemo() {
            if (isRunning) return;
            
            isRunning = true;
            currentStep = 0;
            
            var startBtn = document.getElementById('startBtn');
            var progressContainer = document.getElementById('progressContainer');
            
            startBtn.disabled = true;
            startBtn.innerHTML = 'â³ è¿è¡Œä¸­...';
            progressContainer.style.display = 'block';
            
            var steps = currentTab === 'traditional' ? traditionalSteps : ropeSteps;
            
            // åˆ›å»ºè¿›åº¦ç‚¹
            var progressDots = document.getElementById('progressDots');
            progressDots.innerHTML = '';
            for (var i = 0; i < steps.length; i++) {
                var dot = document.createElement('div');
                dot.className = 'progress-dot';
                progressDots.appendChild(dot);
            }
            
            // é€æ­¥æ‰§è¡Œæ¼”ç¤º
            runSteps(0, steps);
        }

        function runSteps(stepIndex, steps) {
            if (stepIndex >= steps.length) {
                // æ¼”ç¤ºå®Œæˆ
                isRunning = false;
                var startBtn = document.getElementById('startBtn');
                startBtn.disabled = false;
                startBtn.innerHTML = 'â–¶ï¸ å¼€å§‹æ¼”ç¤º';
                return;
            }
            
            currentStep = stepIndex;
            updateProgress();
            updateStepContent();
            updateTokenPairDisplay();
            
            setTimeout(function() {
                runSteps(stepIndex + 1, steps);
            }, 2500);
        }

        // é‡ç½®æ¼”ç¤º
        function resetDemo() {
            isRunning = false;
            currentStep = 0;
            
            var startBtn = document.getElementById('startBtn');
            var progressContainer = document.getElementById('progressContainer');
            
            startBtn.disabled = false;
            startBtn.innerHTML = 'â–¶ï¸ å¼€å§‹æ¼”ç¤º';
            progressContainer.style.display = 'none';
            
            // é‡ç½®æ­¥éª¤å†…å®¹
            updateStepContent();
            updateTokenPairDisplay();
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            var dots = document.querySelectorAll('.progress-dot');
            var progressText = document.getElementById('progressText');
            var steps = currentTab === 'traditional' ? traditionalSteps : ropeSteps;
            
            for (var i = 0; i < dots.length; i++) {
                if (i <= currentStep) {
                    dots[i].classList.add('active');
                } else {
                    dots[i].classList.remove('active');
                }
            }
            
            progressText.textContent = 'æ­¥éª¤ ' + (currentStep + 1) + ' / ' + steps.length;
        }

        // æ›´æ–°æ­¥éª¤å†…å®¹
        function updateStepContent() {
            var steps = currentTab === 'traditional' ? traditionalSteps : ropeSteps;
            var step = steps[currentStep] || steps[0];
            
            var titleId = currentTab === 'traditional' ? 'traditionalStepTitle' : 'ropeStepTitle';
            var descId = currentTab === 'traditional' ? 'traditionalStepDescription' : 'ropeStepDescription';
            var calcId = currentTab === 'traditional' ? 'traditionalCalculation' : 'ropeCalculation';
            var vizId = currentTab === 'traditional' ? 'traditionalVisualization' : 'ropeVisualization';
            
            document.getElementById(titleId).textContent = 'æ­¥éª¤' + (currentStep + 1) + ': ' + step.title;
            document.getElementById(descId).textContent = step.description;
            
            // æ›´æ–°è®¡ç®—å’Œå¯è§†åŒ–å†…å®¹
            if (currentTab === 'traditional') {
                updateTraditionalContent(calcId, vizId, step);
            } else {
                updateRopeContent(calcId, vizId, step);
            }
        }

        // æ›´æ–°ä¼ ç»ŸTransformerå†…å®¹
        function updateTraditionalContent(calcId, vizId, step) {
            var calcElement = document.getElementById(calcId);
            var vizElement = document.getElementById(vizId);
            
            if (step.showEmbedding) {
                // æ˜¾ç¤ºè¯åµŒå…¥æŸ¥æ‰¾è¿‡ç¨‹
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">è¯åµŒå…¥æŸ¥æ‰¾å…¬å¼:</div>' +
                    'embedding = W_embed[token_id]<br>' +
                    'å…¶ä¸­ W_embed æ˜¯é¢„è®­ç»ƒçš„è¯åµŒå…¥çŸ©é˜µ' +
                    '</div>';
                
                var tokenRows = '';
                for (var i = 0; i < tokens.length; i++) {
                    tokenRows += '<div class="token-row">' +
                        '<div class="token-label">' + tokens[i] + '(id=' + vocab[tokens[i]] + '):</div>' +
                        '<div class="token-values">[' + tokenEmbeddings[i].map(x => x.toFixed(2)).join(', ') + ']</div>' +
                        '</div>';
                }
                
                vizElement.innerHTML = 
                    '<div class="matrix-display highlight">' +
                    '<div class="matrix-title">è¯åµŒå…¥å‘é‡ (è¯­ä¹‰è¡¨ç¤º)</div>' +
                    '<div class="matrix-content">' + tokenRows + '</div>' +
                    '</div>';
                    
            } else if (step.showPositional) {
                // æ˜¾ç¤ºä½ç½®ç¼–ç è®¡ç®—
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">ä½ç½®ç¼–ç å…¬å¼:</div>' +
                    'PE(pos, 2i) = sin(pos / 10000^(2i/d_model))<br>' +
                    'PE(pos, 2i+1) = cos(pos / 10000^(2i/d_model))' +
                    '</div>';
                
                var posEncoding = calculateTraditionalPositionalEncoding();
                var posRows = '';
                for (var i = 0; i < tokens.length; i++) {
                    posRows += '<div class="token-row">' +
                        '<div class="token-label">ä½ç½®' + i + ':</div>' +
                        '<div class="token-values">[' + posEncoding[i].map(x => x.toFixed(3)).join(', ') + ']</div>' +
                        '</div>';
                }
                
                // æ·»åŠ è§’åº¦å¯è§†åŒ–
                var angleViz = '';
                for (var i = 0; i < Math.min(tokens.length, 2); i++) {
                    var angle = i * 30; // ç®€åŒ–çš„è§’åº¦è¡¨ç¤º
                    angleViz += 
                        '<div style="display: inline-block; margin: 10px;">' +
                        '<div class="angle-visualization" style="width: 120px; height: 120px;">' +
                        '<div class="angle-center"></div>' +
                        '<div class="angle-line traditional" style="transform: rotate(' + angle + 'deg);"></div>' +
                        '<div class="angle-label traditional" style="top: 5px; right: 5px;">ä½ç½®' + i + '</div>' +
                        '</div>' +
                        '</div>';
                }
                
                vizElement.innerHTML = 
                    '<div class="matrix-display">' +
                    '<div class="matrix-title">ä½ç½®ç¼–ç  (åŸºäºä¸‰è§’å‡½æ•°)</div>' +
                    '<div class="matrix-content">' + posRows + '</div>' +
                    '</div>' +
                    '<div style="text-align: center;">' +
                    '<div style="margin-bottom: 10px; font-weight: 600;">ä½ç½®è§’åº¦å¯è§†åŒ–:</div>' +
                    angleViz +
                    '</div>';
                    
            } else if (step.showFusion) {
                // æ˜¾ç¤ºèåˆè¿‡ç¨‹
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">è¾“å…¥èåˆå…¬å¼:</div>' +
                    'input = token_embedding + positional_encoding<br>' +
                    '(è¯­ä¹‰ä¿¡æ¯ä¸ä½ç½®ä¿¡æ¯æ··åˆ)' +
                    '</div>';
                
                var posEncoding = calculateTraditionalPositionalEncoding();
                var fusedRows = '';
                for (var i = 0; i < tokens.length; i++) {
                    var fused = [];
                    for (var j = 0; j < tokenEmbeddings[i].length; j++) {
                        fused.push(tokenEmbeddings[i][j] + posEncoding[i][j]);
                    }
                    fusedRows += '<div class="token-row">' +
                        '<div class="token-label">' + tokens[i] + ':</div>' +
                        '<div class="token-values">[' + fused.map(x => x.toFixed(2)).join(', ') + ']</div>' +
                        '</div>';
                }
                
                vizElement.innerHTML = 
                    '<div class="matrix-display highlight">' +
                    '<div class="matrix-title">èåˆè¾“å…¥ (è¯­ä¹‰ + ä½ç½®)</div>' +
                    '<div class="matrix-content">' + fusedRows + '</div>' +
                    '</div>';
                    
            } else if (step.showDecay) {
                // æ˜¾ç¤ºä¿¡æ¯è¡°å‡
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">å¤šå±‚å¤„ç†æ•ˆæœ:</div>' +
                    'Layer_n(x) = Attention(x) + FFN(x)<br>' +
                    'ä½ç½®ä¿¡æ¯å¼ºåº¦ â‰ˆ 0.95^n (é€å±‚è¡°å‡)' +
                    '</div>';
                
                var layerInfo = '';
                var layers = [1, 6, 12];
                var strengths = [0.95, 0.60, 0.35];
                
                for (var i = 0; i < layers.length; i++) {
                    var strengthClass = strengths[i] > 0.7 ? 'strength-high' : strengths[i] > 0.4 ? 'strength-medium' : 'strength-low';
                    layerInfo += 
                        '<div style="display: flex; align-items: center; margin: 8px 0;">' +
                        '<div style="width: 80px;">ç¬¬' + layers[i] + 'å±‚:</div>' +
                        '<div style="flex: 1; background: #e2e8f0; height: 20px; border-radius: 10px; overflow: hidden;">' +
                        '<div style="background: ' + (strengthClass === 'strength-high' ? '#48bb78' : strengthClass === 'strength-medium' ? '#ed8936' : '#f56565') + 
                        '; height: 100%; width: ' + (strengths[i] * 100) + '%; transition: all 0.5s;"></div>' +
                        '</div>' +
                        '<div style="width: 60px; text-align: right;">' + Math.round(strengths[i] * 100) + '%</div>' +
                        '</div>';
                }
                
                vizElement.innerHTML = 
                    '<div class="matrix-display">' +
                    '<div class="matrix-title">ä½ç½®ä¿¡æ¯å¼ºåº¦å˜åŒ–</div>' +
                    '<div class="matrix-content">' + layerInfo + '</div>' +
                    '</div>';
                    
            } else if (step.showAttention) {
                // æ˜¾ç¤ºæ³¨æ„åŠ›è®¡ç®—
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">æ³¨æ„åŠ›è®¡ç®—:</div>' +
                    'Attention(Q,K,V) = softmax(QK^T/âˆšd_k)V<br>' +
                    'ç›¸å¯¹ä½ç½®å…³ç³»éœ€è¦ä»èåˆè¡¨ç¤ºä¸­é—´æ¥å­¦ä¹ ' +
                    '</div>';
                
                vizElement.innerHTML = 
                    '<div class="matrix-display">' +
                    '<div class="matrix-title">æ³¨æ„åŠ›æ¨¡å¼ (ä½ç½®ä¿¡æ¯è¡°å‡å)</div>' +
                    '<div class="matrix-content">' +
                    'â€¢ ä¸»è¦ä¾èµ–è¯­ä¹‰ç›¸ä¼¼æ€§<br>' +
                    'â€¢ ä½ç½®å…³ç³»å˜å¾—æ¨¡ç³Š<br>' +
                    'â€¢ é•¿è·ç¦»ä¾èµ–æ•è·å›°éš¾' +
                    '</div>' +
                    '</div>';
            }
        }

        // æ›´æ–°RoPEå†…å®¹
        function updateRopeContent(calcId, vizId, step) {
            var calcElement = document.getElementById(calcId);
            var vizElement = document.getElementById(vizId);
            
            if (step.showEmbedding) {
                // æ˜¾ç¤ºçº¯è¯åµŒå…¥
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">çº¯è¯­ä¹‰åµŒå…¥:</div>' +
                    'input = W_embed[token_id]<br>' +
                    '(ä»…åŒ…å«è¯­ä¹‰ä¿¡æ¯ï¼Œä½ç½®ä¿¡æ¯å°†åœ¨æ³¨æ„åŠ›å±‚åŠ¨æ€è®¡ç®—)' +
                    '</div>';
                
                var tokenRows = '';
                for (var i = 0; i < tokens.length; i++) {
                    tokenRows += '<div class="token-row">' +
                        '<div class="token-label">' + tokens[i] + ':</div>' +
                        '<div class="token-values">[' + tokenEmbeddings[i].map(x => x.toFixed(2)).join(', ') + ']</div>' +
                        '</div>';
                }
                
                vizElement.innerHTML = 
                    '<div class="matrix-display highlight">' +
                    '<div class="matrix-title">çº¯è¯åµŒå…¥ (æ— ä½ç½®ä¿¡æ¯)</div>' +
                    '<div class="matrix-content">' + tokenRows + '</div>' +
                    '</div>';
                    
            } else if (step.showFrequency) {
                // æ˜¾ç¤ºé¢‘ç‡è®¡ç®—
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">RoPEé¢‘ç‡è®¡ç®—:</div>' +
                    'Î¸_i = 1 / (10000^(2i/d_model))<br>' +
                    'æ”¯æŒä»»æ„é•¿åº¦åºåˆ—ï¼Œæ— é¢„å®šä¹‰é™åˆ¶' +
                    '</div>';
                
                var freqs = calculateRopeFrequencies();
                var freqRows = '';
                for (var i = 0; i < freqs.length; i++) {
                    freqRows += '<div class="token-row">' +
                        '<div class="token-label">Î¸_' + i + ':</div>' +
                        '<div class="token-values">' + freqs[i].toFixed(4) + '</div>' +
                        '</div>';
                }
                
                vizElement.innerHTML = 
                    '<div class="matrix-display">' +
                    '<div class="matrix-title">æ—‹è½¬é¢‘ç‡ (æ•°å­¦å…¬å¼ç”Ÿæˆ)</div>' +
                    '<div class="matrix-content">' + freqRows + '</div>' +
                    '</div>';
                    
            } else if (step.showAngles) {
                // æ˜¾ç¤ºè§’åº¦è®¡ç®—å’Œå¯è§†åŒ–
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">ä½ç½®è§’åº¦è®¡ç®—:</div>' +
                    'angle(pos, i) = pos Ã— Î¸_i<br>' +
                    'æ¯ä¸ªä½ç½®çš„æ—‹è½¬è§’åº¦åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¿æŒä¸€è‡´' +
                    '</div>';
                
                var freqs = calculateRopeFrequencies();
                var angleRows = '';
                for (var i = 0; i < tokens.length; i++) {
                    var angles = [];
                    for (var j = 0; j < freqs.length; j++) {
                        angles.push((i * freqs[j]).toFixed(3));
                    }
                    angleRows += '<div class="token-row">' +
                        '<div class="token-label">' + tokens[i] + '(pos=' + i + '):</div>' +
                        '<div class="token-values">[' + angles.join(', ') + ']</div>' +
                        '</div>';
                }
                
                // RoPEè§’åº¦å¯è§†åŒ–
                var angleViz = '';
                for (var i = 0; i < Math.min(tokens.length, 4); i++) {
                    var angle = i * freqs[0] * 180 / Math.PI; // è½¬æ¢ä¸ºåº¦æ•°æ˜¾ç¤º
                    angleViz += 
                        '<div style="display: inline-block; margin: 10px;">' +
                        '<div class="angle-visualization" style="width: 100px; height: 100px;">' +
                        '<div class="angle-center"></div>' +
                        '<div class="angle-line rope" style="transform: rotate(' + (angle * 10) + 'deg);"></div>' +
                        '<div class="angle-label rope" style="top: 5px; right: 5px;">' + tokens[i] + '</div>' +
                        '</div>' +
                        '</div>';
                }
                
                vizElement.innerHTML = 
                    '<div class="matrix-display">' +
                    '<div class="matrix-title">å„ä½ç½®æ—‹è½¬è§’åº¦</div>' +
                    '<div class="matrix-content">' + angleRows + '</div>' +
                    '</div>' +
                    '<div style="text-align: center;">' +
                    '<div style="margin-bottom: 10px; font-weight: 600;">RoPEæ—‹è½¬è§’åº¦å¯è§†åŒ–:</div>' +
                    angleViz +
                    '</div>';
                    
            } else if (step.showRotation) {
                // æ˜¾ç¤ºæ—‹è½¬å˜æ¢
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">æ—‹è½¬å˜æ¢å…¬å¼:</div>' +
                    'q_rotated = q Ã— [cos(Î¸), -sin(Î¸); sin(Î¸), cos(Î¸)]<br>' +
                    'k_rotated = k Ã— [cos(Î¸), -sin(Î¸); sin(Î¸), cos(Î¸)]' +
                    '</div>';
                
                vizElement.innerHTML = 
                    '<div class="matrix-display highlight">' +
                    '<div class="matrix-title">æ—‹è½¬åçš„Qã€KçŸ©é˜µ</div>' +
                    '<div class="matrix-content">' +
                    'æ¯ä¸ªä½ç½®åº”ç”¨å¯¹åº”çš„æ—‹è½¬å˜æ¢<br>' +
                    'ä½ç½®ä¿¡æ¯è¢«ç¼–ç åˆ°å‘é‡çš„æ—‹è½¬è§’åº¦ä¸­<br>' +
                    'ç›¸å¯¹ä½ç½® = è§’åº¦å·®å€¼' +
                    '</div>' +
                    '</div>';
                    
            } else if (step.showRelativeAttention) {
                // æ˜¾ç¤ºç›¸å¯¹ä½ç½®æ³¨æ„åŠ›
                calcElement.innerHTML = 
                    '<div class="formula-box">' +
                    '<div class="formula-title">ç›¸å¯¹ä½ç½®è®¡ç®—:</div>' +
                    'relative_pos = cos((pos_i - pos_j) Ã— Î¸)<br>' +
                    'ç›´æ¥ä»æ—‹è½¬è§’åº¦è®¡ç®—ç›¸å¯¹ä½ç½®å…³ç³»' +
                    '</div>';
                
                vizElement.innerHTML = 
                    '<div style="text-align: center; padding: 40px;">' +
                    '<div style="font-size: 3rem; font-weight: bold; color: #38a169; margin-bottom: 16px;">100%</div>' +
                    '<div style="font-size: 1.1rem; color: #2d3748; margin-bottom: 20px;">ä½ç½®ç²¾åº¦å§‹ç»ˆä¿æŒ</div>' +
                    '<div class="matrix-display">' +
                    '<div class="matrix-title">æ¯å±‚ä½ç½®ä¿¡æ¯å¼ºåº¦</div>' +
                    '<div class="matrix-content">' +
                    'ç¬¬1å±‚: 100% âœ“<br>' +
                    'ç¬¬6å±‚: 100% âœ“<br>' +
                    'ç¬¬12å±‚: 100% âœ“<br>' +
                    'ç¬¬Nå±‚: 100% âœ“' +
                    '</div>' +
                    '</div>' +
                    '</div>';
            }
        }

        // æ›´æ–°è¯å¯¹æ˜¾ç¤º
        function updateTokenPairDisplay() {
            var traditionalContainer = document.getElementById('traditionalTokenPair');
            var ropeContainer = document.getElementById('ropeTokenPair');
            
            var token1 = tokens[selectedTokenPair[0]];
            var token2 = tokens[selectedTokenPair[1]];
            var distance = Math.abs(selectedTokenPair[1] - selectedTokenPair[0]);
            
            var tokenPairHtml = 
                '<div class="token-pair">' +
                '<div class="token-box">' +
                '<div class="token-name">' + token1 + '</div>' +
                '<div class="token-pos">ä½ç½® ' + selectedTokenPair[0] + '</div>' +
                '</div>' +
                '<div class="arrow">â†’</div>' +
                '<div class="token-box">' +
                '<div class="token-name">' + token2 + '</div>' +
                '<div class="token-pos">ä½ç½® ' + selectedTokenPair[1] + '</div>' +
                '</div>' +
                '<div class="relative-distance">ç›¸å¯¹è·ç¦»: ' + distance + '</div>' +
                '</div>';
            
            if (currentTab === 'traditional') {
                var traditionalAnalysis = '';
                if (currentStep >= 2) { // èåˆå
                    traditionalAnalysis = 
                        '<div style="margin-top: 16px; padding: 12px; background: #fed7d7; border-radius: 6px;">' +
                        '<div style="font-weight: 600; color: #c53030;">ä¼ ç»Ÿæ–¹æ³•ä½ç½®å…³ç³»:</div>' +
                        '<div style="font-size: 0.9rem;">â€¢ ä½ç½®ä¿¡æ¯å·²ä¸è¯­ä¹‰ä¿¡æ¯æ··åˆ</div>' +
                        '<div style="font-size: 0.9rem;">â€¢ éšå±‚æ•°å¢åŠ ï¼Œä½ç½®å…³ç³»é€æ¸æ¨¡ç³Š</div>' +
                        '<div style="font-size: 0.9rem;">â€¢ éœ€è¦ä»æ··åˆè¡¨ç¤ºä¸­é—´æ¥å­¦ä¹ ç›¸å¯¹ä½ç½®</div>' +
                        '</div>';
                }
                traditionalContainer.innerHTML = tokenPairHtml + traditionalAnalysis;
            } else {
                var ropeAnalysis = '';
                if (currentStep >= 2) { // è§’åº¦è®¡ç®—å
                    var freqs = calculateRopeFrequencies();
                    var angle1 = selectedTokenPair[0] * freqs[0];
                    var angle2 = selectedTokenPair[1] * freqs[0];
                    var relativeAngle = Math.abs(angle2 - angle1);
                    
                    ropeAnalysis = 
                        '<div style="margin-top: 16px; padding: 12px; background: #c6f6d5; border-radius: 6px;">' +
                        '<div style="font-weight: 600; color: #2f855a;">RoPEç›¸å¯¹ä½ç½®:</div>' +
                        '<div style="font-size: 0.9rem;">â€¢ ' + token1 + 'è§’åº¦: ' + angle1.toFixed(3) + '</div>' +
                        '<div style="font-size: 0.9rem;">â€¢ ' + token2 + 'è§’åº¦: ' + angle2.toFixed(3) + '</div>' +
                        '<div style="font-size: 0.9rem;">â€¢ ç›¸å¯¹è§’åº¦: ' + relativeAngle.toFixed(3) + '</div>' +
                        '<div style="font-size: 0.9rem;">â€¢ ç²¾ç¡®çš„æ•°å­¦å…³ç³»ï¼Œæ°¸ä¸è¡°å‡</div>' +
                        '</div>';
                }
                ropeContainer.innerHTML = tokenPairHtml + ropeAnalysis;
            }
        }

        // è¾…åŠ©å‡½æ•°
        function calculateTraditionalPositionalEncoding() {
            var d_model = 4;
            var max_len = tokens.length;
            var encoding = [];
            
            for (var pos = 0; pos < max_len; pos++) {
                var row = [];
                for (var i = 0; i < d_model; i++) {
                    if (i % 2 === 0) {
                        row.push(Math.sin(pos / Math.pow(10000, i / d_model)));
                    } else {
                        row.push(Math.cos(pos / Math.pow(10000, (i-1) / d_model)));
                    }
                }
                encoding.push(row);
            }
            return encoding;
        }

        function calculateRopeFrequencies() {
            var d_model = 4;
            var freqs = [];
            for (var i = 0; i < d_model / 2; i++) {
                freqs.push(1.0 / Math.pow(10000, 2 * i / d_model));
            }
            return freqs;
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStepContent();
            updateTokenPairDisplay();
        });
    </script>
</body>
</html>
