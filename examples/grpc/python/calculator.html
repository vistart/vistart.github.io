<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gRPC Calculator Demo</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2 {
            color: #4fc3f7;
            border-bottom: 2px solid #4fc3f7;
            padding-bottom: 10px;
        }
        .file-section {
            background: #2d2d2d;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid #404040;
        }
        .file-header {
            background: #404040;
            padding: 12px 20px;
            color: #fff;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .file-icon {
            margin-right: 10px;
            font-size: 18px;
        }
        .code-content {
            padding: 20px;
            background: #1e1e1e;
            overflow-x: auto;
        }
        pre {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
        }
        .command-section {
            background: #0d47a1;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .step {
            background: #2e7d32;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: bold;
        }
        .keyword { color: #ff7043; }
        .string { color: #66bb6a; }
        .comment { color: #616161; font-style: italic; }
        .function { color: #42a5f5; }
        .number { color: #ab47bc; }
        
        .demo-controls {
            background: #424242;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .demo-controls button {
            background: #4fc3f7;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        .demo-controls button:hover {
            background: #29b6f6;
        }
        .output {
            background: #1a1a1a;
            border: 1px solid #404040;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            min-height: 100px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ gRPC Calculator Service - Python3 Complete Demo</h1>
        
        <div class="step">æ­¥éª¤ 1: å®šä¹‰Protocol BufferæœåŠ¡æ¥å£</div>
        
        <div class="file-section">
            <div class="file-header">
                <span class="file-icon">ğŸ“„</span>
                calculator.proto
            </div>
            <div class="code-content">
                <pre><code><span class="comment">// Protocol Buffer å®šä¹‰æ–‡ä»¶</span>
<span class="keyword">syntax</span> = <span class="string">"proto3"</span>;

<span class="keyword">package</span> calculator;

<span class="comment">// è®¡ç®—å™¨æœåŠ¡å®šä¹‰</span>
<span class="keyword">service</span> <span class="function">Calculator</span> {
    <span class="comment">// åŠ æ³•è¿ç®—</span>
    <span class="keyword">rpc</span> <span class="function">Add</span>(<span class="function">BinaryOperation</span>) <span class="keyword">returns</span> (<span class="function">Result</span>);
    
    <span class="comment">// å‡æ³•è¿ç®—</span>
    <span class="keyword">rpc</span> <span class="function">Subtract</span>(<span class="function">BinaryOperation</span>) <span class="keyword">returns</span> (<span class="function">Result</span>);
    
    <span class="comment">// ä¹˜æ³•è¿ç®—</span>
    <span class="keyword">rpc</span> <span class="function">Multiply</span>(<span class="function">BinaryOperation</span>) <span class="keyword">returns</span> (<span class="function">Result</span>);
    
    <span class="comment">// é™¤æ³•è¿ç®—</span>
    <span class="keyword">rpc</span> <span class="function">Divide</span>(<span class="function">BinaryOperation</span>) <span class="keyword">returns</span> (<span class="function">Result</span>);
    
    <span class="comment">// æµå¼è®¡ç®— - å‘é€å¤šä¸ªè¿ç®—ï¼Œè¿”å›è¿ç®—å†å²</span>
    <span class="keyword">rpc</span> <span class="function">CalculateStream</span>(<span class="keyword">stream</span> <span class="function">BinaryOperation</span>) <span class="keyword">returns</span> (<span class="keyword">stream</span> <span class="function">Result</span>);
}

<span class="comment">// äºŒå…ƒè¿ç®—æ¶ˆæ¯</span>
<span class="keyword">message</span> <span class="function">BinaryOperation</span> {
    <span class="keyword">double</span> a = <span class="number">1</span>;
    <span class="keyword">double</span> b = <span class="number">2</span>;
    <span class="keyword">string</span> operation = <span class="number">3</span>; <span class="comment">// "add", "subtract", "multiply", "divide"</span>
}

<span class="comment">// è®¡ç®—ç»“æœæ¶ˆæ¯</span>
<span class="keyword">message</span> <span class="function">Result</span> {
    <span class="keyword">double</span> value = <span class="number">1</span>;
    <span class="keyword">string</span> message = <span class="number">2</span>;
    <span class="keyword">bool</span> success = <span class="number">3</span>;
}</code></pre>
            </div>
        </div>

        <div class="command-section">
            <h3>ğŸ”§ ç”ŸæˆPythonä»£ç å‘½ä»¤</h3>
            <pre><code># å®‰è£…ä¾èµ–
pip install grpcio grpcio-tools

# ç”ŸæˆPython gRPCä»£ç 
python -m grpc_tools.protoc --proto_path=. --python_out=. --grpc_python_out=. calculator.proto</code></pre>
        </div>

        <div class="step">æ­¥éª¤ 2: å®ç°gRPCæœåŠ¡ç«¯</div>

        <div class="file-section">
            <div class="file-header">
                <span class="file-icon">ğŸ</span>
                calculator_server.py
            </div>
            <div class="code-content">
                <pre><code><span class="keyword">import</span> grpc
<span class="keyword">from</span> concurrent <span class="keyword">import</span> futures
<span class="keyword">import</span> time
<span class="keyword">import</span> logging

<span class="comment"># å¯¼å…¥ç”Ÿæˆçš„gRPCä»£ç </span>
<span class="keyword">import</span> calculator_pb2
<span class="keyword">import</span> calculator_pb2_grpc

<span class="comment"># é…ç½®æ—¥å¿—</span>
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

<span class="keyword">class</span> <span class="function">CalculatorServicer</span>(calculator_pb2_grpc.CalculatorServicer):
    <span class="string">"""è®¡ç®—å™¨æœåŠ¡å®ç°"""</span>
    
    <span class="keyword">def</span> <span class="function">Add</span>(<span class="keyword">self</span>, request, context):
        <span class="string">"""åŠ æ³•è¿ç®—"""</span>
        result = request.a + request.b
        logger.info(<span class="string">f"Add: {request.a} + {request.b} = {result}"</span>)
        
        <span class="keyword">return</span> calculator_pb2.Result(
            value=result,
            message=<span class="string">f"{request.a} + {request.b} = {result}"</span>,
            success=<span class="keyword">True</span>
        )
    
    <span class="keyword">def</span> <span class="function">Subtract</span>(<span class="keyword">self</span>, request, context):
        <span class="string">"""å‡æ³•è¿ç®—"""</span>
        result = request.a - request.b
        logger.info(<span class="string">f"Subtract: {request.a} - {request.b} = {result}"</span>)
        
        <span class="keyword">return</span> calculator_pb2.Result(
            value=result,
            message=<span class="string">f"{request.a} - {request.b} = {result}"</span>,
            success=<span class="keyword">True</span>
        )
    
    <span class="keyword">def</span> <span class="function">Multiply</span>(<span class="keyword">self</span>, request, context):
        <span class="string">"""ä¹˜æ³•è¿ç®—"""</span>
        result = request.a * request.b
        logger.info(<span class="string">f"Multiply: {request.a} * {request.b} = {result}"</span>)
        
        <span class="keyword">return</span> calculator_pb2.Result(
            value=result,
            message=<span class="string">f"{request.a} * {request.b} = {result}"</span>,
            success=<span class="keyword">True</span>
        )
    
    <span class="keyword">def</span> <span class="function">Divide</span>(<span class="keyword">self</span>, request, context):
        <span class="string">"""é™¤æ³•è¿ç®—"""</span>
        <span class="keyword">if</span> request.b == <span class="number">0</span>:
            logger.warning(<span class="string">"Division by zero attempted"</span>)
            <span class="keyword">return</span> calculator_pb2.Result(
                value=<span class="number">0</span>,
                message=<span class="string">"é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶"</span>,
                success=<span class="keyword">False</span>
            )
        
        result = request.a / request.b
        logger.info(<span class="string">f"Divide: {request.a} / {request.b} = {result}"</span>)
        
        <span class="keyword">return</span> calculator_pb2.Result(
            value=result,
            message=<span class="string">f"{request.a} / {request.b} = {result}"</span>,
            success=<span class="keyword">True</span>
        )
    
    <span class="keyword">def</span> <span class="function">CalculateStream</span>(<span class="keyword">self</span>, request_iterator, context):
        <span class="string">"""æµå¼è®¡ç®— - å¤„ç†å¤šä¸ªè¿ç®—è¯·æ±‚"""</span>
        calculation_count = <span class="number">0</span>
        
        <span class="keyword">for</span> request <span class="keyword">in</span> request_iterator:
            calculation_count += <span class="number">1</span>
            
            <span class="comment"># æ ¹æ®æ“ä½œç±»å‹è¿›è¡Œè®¡ç®—</span>
            <span class="keyword">if</span> request.operation == <span class="string">"add"</span>:
                result = request.a + request.b
            <span class="keyword">elif</span> request.operation == <span class="string">"subtract"</span>:
                result = request.a - request.b
            <span class="keyword">elif</span> request.operation == <span class="string">"multiply"</span>:
                result = request.a * request.b
            <span class="keyword">elif</span> request.operation == <span class="string">"divide"</span>:
                <span class="keyword">if</span> request.b == <span class="number">0</span>:
                    <span class="keyword">yield</span> calculator_pb2.Result(
                        value=<span class="number">0</span>,
                        message=<span class="string">f"è®¡ç®— #{calculation_count}: é”™è¯¯ - é™¤æ•°ä¸èƒ½ä¸ºé›¶"</span>,
                        success=<span class="keyword">False</span>
                    )
                    <span class="keyword">continue</span>
                result = request.a / request.b
            <span class="keyword">else</span>:
                <span class="keyword">yield</span> calculator_pb2.Result(
                    value=<span class="number">0</span>,
                    message=<span class="string">f"è®¡ç®— #{calculation_count}: æœªçŸ¥æ“ä½œ '{request.operation}'"</span>,
                    success=<span class="keyword">False</span>
                )
                <span class="keyword">continue</span>
            
            logger.info(<span class="string">f"Stream calculation #{calculation_count}: {request.a} {request.operation} {request.b} = {result}"</span>)
            
            <span class="keyword">yield</span> calculator_pb2.Result(
                value=result,
                message=<span class="string">f"è®¡ç®— #{calculation_count}: {request.a} {request.operation} {request.b} = {result}"</span>,
                success=<span class="keyword">True</span>
            )
            
            <span class="comment"># æ¨¡æ‹Ÿå¤„ç†æ—¶é—´</span>
            time.sleep(<span class="number">0.1</span>)

<span class="keyword">def</span> <span class="function">serve</span>():
    <span class="string">"""å¯åŠ¨gRPCæœåŠ¡å™¨"""</span>
    <span class="comment"># åˆ›å»ºgRPCæœåŠ¡å™¨</span>
    server = grpc.server(futures.ThreadPoolExecutor(max_workers=<span class="number">10</span>))
    
    <span class="comment"># æ·»åŠ æœåŠ¡åˆ°æœåŠ¡å™¨</span>
    calculator_pb2_grpc.add_CalculatorServicer_to_server(
        CalculatorServicer(), server
    )
    
    <span class="comment"># ç›‘å¬ç«¯å£</span>
    listen_addr = <span class="string">'[::]:50051'</span>
    server.add_insecure_port(listen_addr)
    
    <span class="comment"># å¯åŠ¨æœåŠ¡å™¨</span>
    server.start()
    logger.info(<span class="string">f"Calculator gRPC server started on {listen_addr}"</span>)
    
    <span class="keyword">try</span>:
        server.wait_for_termination()
    <span class="keyword">except</span> KeyboardInterrupt:
        logger.info(<span class="string">"Shutting down server..."</span>)
        server.stop(<span class="number">0</span>)

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    serve()
</code></pre>
            </div>
        </div>

        <div class="step">æ­¥éª¤ 3: å®ç°gRPCå®¢æˆ·ç«¯</div>

        <div class="file-section">
            <div class="file-header">
                <span class="file-icon">ğŸ</span>
                calculator_client.py
            </div>
            <div class="code-content">
                <pre><code><span class="keyword">import</span> grpc
<span class="keyword">import</span> time
<span class="keyword">import</span> logging

<span class="comment"># å¯¼å…¥ç”Ÿæˆçš„gRPCä»£ç </span>
<span class="keyword">import</span> calculator_pb2
<span class="keyword">import</span> calculator_pb2_grpc

<span class="comment"># é…ç½®æ—¥å¿—</span>
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

<span class="keyword">class</span> <span class="function">CalculatorClient</span>:
    <span class="string">"""è®¡ç®—å™¨å®¢æˆ·ç«¯"""</span>
    
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, server_address=<span class="string">'localhost:50051'</span>):
        <span class="keyword">self</span>.server_address = server_address
        <span class="keyword">self</span>.channel = <span class="keyword">None</span>
        <span class="keyword">self</span>.stub = <span class="keyword">None</span>
    
    <span class="keyword">def</span> <span class="function">connect</span>(<span class="keyword">self</span>):
        <span class="string">"""è¿æ¥åˆ°gRPCæœåŠ¡å™¨"""</span>
        <span class="keyword">self</span>.channel = grpc.insecure_channel(<span class="keyword">self</span>.server_address)
        <span class="keyword">self</span>.stub = calculator_pb2_grpc.CalculatorStub(<span class="keyword">self</span>.channel)
        logger.info(<span class="string">f"Connected to gRPC server at {<span class="keyword">self</span>.server_address}"</span>)
    
    <span class="keyword">def</span> <span class="function">disconnect</span>(<span class="keyword">self</span>):
        <span class="string">"""æ–­å¼€è¿æ¥"""</span>
        <span class="keyword">if</span> <span class="keyword">self</span>.channel:
            <span class="keyword">self</span>.channel.close()
            logger.info(<span class="string">"Disconnected from gRPC server"</span>)
    
    <span class="keyword">def</span> <span class="function">add</span>(<span class="keyword">self</span>, a, b):
        <span class="string">"""åŠ æ³•è¿ç®—"""</span>
        request = calculator_pb2.BinaryOperation(a=a, b=b)
        response = <span class="keyword">self</span>.stub.Add(request)
        <span class="keyword">return</span> response
    
    <span class="keyword">def</span> <span class="function">subtract</span>(<span class="keyword">self</span>, a, b):
        <span class="string">"""å‡æ³•è¿ç®—"""</span>
        request = calculator_pb2.BinaryOperation(a=a, b=b)
        response = <span class="keyword">self</span>.stub.Subtract(request)
        <span class="keyword">return</span> response
    
    <span class="keyword">def</span> <span class="function">multiply</span>(<span class="keyword">self</span>, a, b):
        <span class="string">"""ä¹˜æ³•è¿ç®—"""</span>
        request = calculator_pb2.BinaryOperation(a=a, b=b)
        response = <span class="keyword">self</span>.stub.Multiply(request)
        <span class="keyword">return</span> response
    
    <span class="keyword">def</span> <span class="function">divide</span>(<span class="keyword">self</span>, a, b):
        <span class="string">"""é™¤æ³•è¿ç®—"""</span>
        request = calculator_pb2.BinaryOperation(a=a, b=b)
        response = <span class="keyword">self</span>.stub.Divide(request)
        <span class="keyword">return</span> response
    
    <span class="keyword">def</span> <span class="function">calculate_stream</span>(<span class="keyword">self</span>, operations):
        <span class="string">"""æµå¼è®¡ç®—"""</span>
        <span class="keyword">def</span> <span class="function">generate_requests</span>():
            <span class="keyword">for</span> op <span class="keyword">in</span> operations:
                <span class="keyword">yield</span> calculator_pb2.BinaryOperation(
                    a=op[<span class="string">'a'</span>], 
                    b=op[<span class="string">'b'</span>], 
                    operation=op[<span class="string">'operation'</span>]
                )
                time.sleep(<span class="number">0.5</span>)  <span class="comment"># æ¨¡æ‹Ÿé—´éš”å‘é€</span>
        
        responses = <span class="keyword">self</span>.stub.CalculateStream(generate_requests())
        <span class="keyword">return</span> responses

<span class="keyword">def</span> <span class="function">demo_basic_operations</span>():
    <span class="string">"""æ¼”ç¤ºåŸºæœ¬è¿ç®—"""</span>
    client = CalculatorClient()
    client.connect()
    
    <span class="keyword">print</span>(<span class="string">"=== åŸºæœ¬è¿ç®—æ¼”ç¤º ==="</span>)
    
    <span class="comment"># åŠ æ³•</span>
    result = client.add(<span class="number">10</span>, <span class="number">5</span>)
    <span class="keyword">print</span>(<span class="string">f"åŠ æ³•: {result.message} (æˆåŠŸ: {result.success})"</span>)
    
    <span class="comment"># å‡æ³•</span>
    result = client.subtract(<span class="number">10</span>, <span class="number">3</span>)
    <span class="keyword">print</span>(<span class="string">f"å‡æ³•: {result.message} (æˆåŠŸ: {result.success})"</span>)
    
    <span class="comment"># ä¹˜æ³•</span>
    result = client.multiply(<span class="number">7</span>, <span class="number">8</span>)
    <span class="keyword">print</span>(<span class="string">f"ä¹˜æ³•: {result.message} (æˆåŠŸ: {result.success})"</span>)
    
    <span class="comment"># é™¤æ³•</span>
    result = client.divide(<span class="number">20</span>, <span class="number">4</span>)
    <span class="keyword">print</span>(<span class="string">f"é™¤æ³•: {result.message} (æˆåŠŸ: {result.success})"</span>)
    
    <span class="comment"># é™¤é›¶æµ‹è¯•</span>
    result = client.divide(<span class="number">10</span>, <span class="number">0</span>)
    <span class="keyword">print</span>(<span class="string">f"é™¤é›¶æµ‹è¯•: {result.message} (æˆåŠŸ: {result.success})"</span>)
    
    client.disconnect()

<span class="keyword">def</span> <span class="function">demo_stream_operations</span>():
    <span class="string">"""æ¼”ç¤ºæµå¼è¿ç®—"""</span>
    client = CalculatorClient()
    client.connect()
    
    <span class="keyword">print</span>(<span class="string">"\n=== æµå¼è¿ç®—æ¼”ç¤º ==="</span>)
    
    <span class="comment"># å‡†å¤‡å¤šä¸ªè¿ç®—</span>
    operations = [
        {<span class="string">'a'</span>: <span class="number">10</span>, <span class="string">'b'</span>: <span class="number">5</span>, <span class="string">'operation'</span>: <span class="string">'add'</span>},
        {<span class="string">'a'</span>: <span class="number">15</span>, <span class="string">'b'</span>: <span class="number">3</span>, <span class="string">'operation'</span>: <span class="string">'multiply'</span>},
        {<span class="string">'a'</span>: <span class="number">20</span>, <span class="string">'b'</span>: <span class="number">4</span>, <span class="string">'operation'</span>: <span class="string">'divide'</span>},
        {<span class="string">'a'</span>: <span class="number">100</span>, <span class="string">'b'</span>: <span class="number">25</span>, <span class="string">'operation'</span>: <span class="string">'subtract'</span>},
        {<span class="string">'a'</span>: <span class="number">8</span>, <span class="string">'b'</span>: <span class="number">0</span>, <span class="string">'operation'</span>: <span class="string">'divide'</span>},  <span class="comment"># é™¤é›¶æµ‹è¯•</span>
    ]
    
    <span class="comment"># å‘é€æµå¼è¯·æ±‚å¹¶æ¥æ”¶å“åº”</span>
    responses = client.calculate_stream(operations)
    
    <span class="keyword">for</span> response <span class="keyword">in</span> responses:
        <span class="keyword">print</span>(<span class="string">f"æµå¼è®¡ç®—ç»“æœ: {response.message} (æˆåŠŸ: {response.success})"</span>)
    
    client.disconnect()

<span class="keyword">def</span> <span class="function">interactive_demo</span>():
    <span class="string">"""äº¤äº’å¼æ¼”ç¤º"""</span>
    client = CalculatorClient()
    client.connect()
    
    <span class="keyword">print</span>(<span class="string">"\n=== äº¤äº’å¼è®¡ç®—å™¨ ==="</span>)
    <span class="keyword">print</span>(<span class="string">"è¾“å…¥ 'quit' é€€å‡º"</span>)
    
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="keyword">try</span>:
            operation = input(<span class="string">"\né€‰æ‹©æ“ä½œ (add/subtract/multiply/divide): "</span>).strip().lower()
            
            <span class="keyword">if</span> operation == <span class="string">'quit'</span>:
                <span class="keyword">break</span>
            
            <span class="keyword">if</span> operation <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'add'</span>, <span class="string">'subtract'</span>, <span class="string">'multiply'</span>, <span class="string">'divide'</span>]:
                <span class="keyword">print</span>(<span class="string">"æ— æ•ˆæ“ä½œï¼è¯·è¾“å…¥ add, subtract, multiply æˆ– divide"</span>)
                <span class="keyword">continue</span>
            
            a = <span class="keyword">float</span>(input(<span class="string">"è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—: "</span>))
            b = <span class="keyword">float</span>(input(<span class="string">"è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—: "</span>))
            
            <span class="keyword">if</span> operation == <span class="string">'add'</span>:
                result = client.add(a, b)
            <span class="keyword">elif</span> operation == <span class="string">'subtract'</span>:
                result = client.subtract(a, b)
            <span class="keyword">elif</span> operation == <span class="string">'multiply'</span>:
                result = client.multiply(a, b)
            <span class="keyword">else</span>:  <span class="comment"># divide</span>
                result = client.divide(a, b)
            
            <span class="keyword">print</span>(<span class="string">f"ç»“æœ: {result.message}"</span>)
            
        <span class="keyword">except</span> ValueError:
            <span class="keyword">print</span>(<span class="string">"è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—ï¼"</span>)
        <span class="keyword">except</span> KeyboardInterrupt:
            <span class="keyword">break</span>
        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
            <span class="keyword">print</span>(<span class="string">f"é”™è¯¯: {e}"</span>)
    
    client.disconnect()
    <span class="keyword">print</span>(<span class="string">"å†è§ï¼"</span>)

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    <span class="keyword">try</span>:
        <span class="comment"># è¿è¡Œæ¼”ç¤º</span>
        demo_basic_operations()
        demo_stream_operations()
        interactive_demo()
        
    <span class="keyword">except</span> grpc.RpcError <span class="keyword">as</span> e:
        <span class="keyword">print</span>(<span class="string">f"gRPCé”™è¯¯: {e.details()}"</span>)
        <span class="keyword">print</span>(<span class="string">"è¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼"</span>)
    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
        <span class="keyword">print</span>(<span class="string">f"å®¢æˆ·ç«¯é”™è¯¯: {e}"</span>)
</code></pre>
            </div>
        </div>

        <div class="step">æ­¥éª¤ 4: åˆ›å»ºé¡¹ç›®å¯åŠ¨è„šæœ¬</div>

        <div class="file-section">
            <div class="file-header">
                <span class="file-icon">ğŸ“œ</span>
                run_demo.py
            </div>
            <div class="code-content">
                <pre><code><span class="keyword">import</span> subprocess
<span class="keyword">import</span> sys
<span class="keyword">import</span> time
<span class="keyword">import</span> threading
<span class="keyword">import</span> os

<span class="keyword">def</span> <span class="function">generate_proto_code</span>():
    <span class="string">"""ç”ŸæˆProtocol Bufferä»£ç """</span>
    <span class="keyword">print</span>(<span class="string">"ğŸ”§ ç”ŸæˆgRPCä»£ç ..."</span>)
    
    <span class="comment"># åˆ›å»ºprotoæ–‡ä»¶</span>
    proto_content = <span class="string">'''syntax = "proto3";

package calculator;

service Calculator {
    rpc Add(BinaryOperation) returns (Result);
    rpc Subtract(BinaryOperation) returns (Result);
    rpc Multiply(BinaryOperation) returns (Result);
    rpc Divide(BinaryOperation) returns (Result);
    rpc CalculateStream(stream BinaryOperation) returns (stream Result);
}

message BinaryOperation {
    double a = 1;
    double b = 2;
    string operation = 3;
}

message Result {
    double value = 1;
    string message = 2;
    bool success = 3;
}'''</span>
    
    <span class="keyword">with</span> open(<span class="string">'calculator.proto'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:
        f.write(proto_content)
    
    <span class="comment"># ç”ŸæˆPythonä»£ç </span>
    <span class="keyword">try</span>:
        subprocess.run([
            sys.executable, <span class="string">'-m'</span>, <span class="string">'grpc_tools.protoc'</span>,
            <span class="string">'--proto_path=.'</span>,
            <span class="string">'--python_out=.'</span>,
            <span class="string">'--grpc_python_out=.'</span>,
            <span class="string">'calculator.proto'</span>
        ], check=<span class="keyword">True</span>)
        <span class="keyword">print</span>(<span class="string">"âœ… gRPCä»£ç ç”ŸæˆæˆåŠŸï¼"</span>)
    <span class="keyword">except</span> subprocess.CalledProcessError:
        <span class="keyword">print</span>(<span class="string">"âŒ ä»£ç ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥grpcio-toolsæ˜¯å¦å®‰è£…"</span>)
        <span class="keyword">return</span> <span class="keyword">False</span>
    
    <span class="keyword">return</span> <span class="keyword">True</span>

<span class="keyword">def</span> <span class="function">check_dependencies</span>():
    <span class="string">"""æ£€æŸ¥ä¾èµ–åŒ…"""</span>
    <span class="keyword">print</span>(<span class="string">"ğŸ“¦ æ£€æŸ¥ä¾èµ–åŒ…..."</span>)
    
    required_packages = [<span class="string">'grpcio'</span>, <span class="string">'grpcio-tools'</span>]
    missing_packages = []
    
    <span class="keyword">for</span> package <span class="keyword">in</span> required_packages:
        <span class="keyword">try</span>:
            __import__(package.replace(<span class="string">'-'</span>, <span class="string">'_'</span>))
        <span class="keyword">except</span> ImportError:
            missing_packages.append(package)
    
    <span class="keyword">if</span> missing_packages:
        <span class="keyword">print</span>(<span class="string">f"âŒ ç¼ºå°‘ä¾èµ–åŒ…: {', '.join(missing_packages)}"</span>)
        <span class="keyword">print</span>(<span class="string">"è¯·è¿è¡Œ: pip install grpcio grpcio-tools"</span>)
        <span class="keyword">return</span> <span class="keyword">False</span>
    
    <span class="keyword">print</span>(<span class="string">"âœ… æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…"</span>)
    <span class="keyword">return</span> <span class="keyword">True</span>

<span class="keyword">def</span> <span class="function">run_server</span>():
    <span class="string">"""åœ¨åå°è¿è¡ŒæœåŠ¡å™¨"""</span>
    <span class="keyword">import</span> calculator_server
    calculator_server.serve()

<span class="keyword">def</span> <span class="function">main</span>():
    <span class="string">"""ä¸»å‡½æ•°"""</span>
    <span class="keyword">print</span>(<span class="string">"ğŸš€ gRPC Calculator Demo å¯åŠ¨ä¸­..."</span>)
    
    <span class="comment"># æ£€æŸ¥ä¾èµ–</span>
    <span class="keyword">if</span> <span class="keyword">not</span> check_dependencies():
        <span class="keyword">return</span>
    
    <span class="comment"># ç”Ÿæˆä»£ç </span>
    <span class="keyword">if</span> <span class="keyword">not</span> generate_proto_code():
        <span class="keyword">return</span>
    
    <span class="comment"># å¯åŠ¨æœåŠ¡å™¨</span>
    <span class="keyword">print</span>(<span class="string">"ğŸ”¥ å¯åŠ¨gRPCæœåŠ¡å™¨..."</span>)
    server_thread = threading.Thread(target=run_server, daemon=<span class="keyword">True</span>)
    server_thread.start()
    
    <span class="comment"># ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨</span>
    time.sleep(<span class="number">2</span>)
    
    <span class="comment"># è¿è¡Œå®¢æˆ·ç«¯æ¼”ç¤º</span>
    <span class="keyword">print</span>(<span class="string">"ğŸ¯ å¯åŠ¨å®¢æˆ·ç«¯æ¼”ç¤º..."</span>)
    <span class="keyword">import</span> calculator_client
    
    <span class="keyword">try</span>:
        calculator_client.demo_basic_operations()
        calculator_client.demo_stream_operations()
        
        <span class="keyword">print</span>(<span class="string">"\nğŸ® å¯åŠ¨äº¤äº’å¼æ¼”ç¤º..."</span>)
        calculator_client.interactive_demo()
        
    <span class="keyword">except</span> KeyboardInterrupt:
        <span class="keyword">print</span>(<span class="string">"\nğŸ‘‹ æ¼”ç¤ºç»“æŸ"</span>)

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    main()
</code></pre>
            </div>
        </div>

        <div class="step">æ­¥éª¤ 5: è¿è¡Œå®Œæ•´æ¼”ç¤º</div>

        <div class="demo-controls">
            <h3>ğŸ® æ¼”ç¤ºè¯´æ˜</h3>
            <p>è¿™ä¸ªå®Œæ•´çš„gRPCæ¼”ç¤ºåŒ…å«ï¼š</p>
            <ul>
                <li><strong>Protocol Bufferå®šä¹‰</strong> - å®šä¹‰æœåŠ¡æ¥å£å’Œæ¶ˆæ¯æ ¼å¼</li>
                <li><strong>æœåŠ¡ç«¯å®ç°</strong> - å®ç°è®¡ç®—å™¨æœåŠ¡ï¼Œæ”¯æŒåŸºæœ¬è¿ç®—å’Œæµå¼å¤„ç†</li>
                <li><strong>å®¢æˆ·ç«¯å®ç°</strong> - è°ƒç”¨è¿œç¨‹æœåŠ¡çš„å®¢æˆ·ç«¯</li>
                <li><strong>è‡ªåŠ¨åŒ–è„šæœ¬</strong> - ä¸€é”®ç”Ÿæˆä»£ç å¹¶è¿è¡Œæ¼”ç¤º</li>
            </ul>
            
            <div class="command-section">
                <h3>ğŸ”§ è¿è¡Œæ­¥éª¤</h3>
                <pre><code># 1. å®‰è£…ä¾èµ–
pip install grpcio grpcio-tools

# 2. ä¿å­˜æ‰€æœ‰ä»£ç æ–‡ä»¶åˆ°åŒä¸€ç›®å½•

# 3. è¿è¡Œå®Œæ•´æ¼”ç¤º
python run_demo.py

# æˆ–è€…åˆ†åˆ«è¿è¡Œï¼š
# ç»ˆç«¯1 - å¯åŠ¨æœåŠ¡å™¨
python calculator_server.py

# ç»ˆç«¯2 - è¿è¡Œå®¢æˆ·ç«¯
python calculator_client.py</code></pre>
            </div>
        </div>

        <div class="step">ç‰¹æ€§äº®ç‚¹</div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
            <div class="file-section">
                <div class="file-header">
                    <span class="file-icon">ğŸ”§</span>
                    è‡ªåŠ¨ä»£ç ç”Ÿæˆ
                </div>
                <div class="code-content">
                    <p>â€¢ è‡ªåŠ¨ç”ŸæˆProtocol Bufferä»£ç </p>
                    <p>â€¢ ä¾èµ–æ£€æŸ¥å’Œå®‰è£…æç¤º</p>
                    <p>â€¢ ä¸€é”®å¯åŠ¨å®Œæ•´æ¼”ç¤º</p>
                </div>
            </div>

            <div class="file-section">
                <div class="file-header">
                    <span class="file-icon">ğŸŒŠ</span>
                    æµå¼å¤„ç†
                </div>
                <div class="code-content">
                    <p>â€¢ æ”¯æŒå®¢æˆ·ç«¯æµå¼å‘é€</p>
                    <p>â€¢ æœåŠ¡ç«¯æµå¼å“åº”</p>
                    <p>â€¢ å®æ—¶å¤„ç†å¤šä¸ªè®¡ç®—è¯·æ±‚</p>
                </div>
            </div>

            <div class="file-section">
                <div class="file-header">
                    <span class="file-icon">ğŸ›¡ï¸</span>
                    é”™è¯¯å¤„ç†
                </div>
                <div class="code-content">
                    <p>â€¢ é™¤é›¶å¼‚å¸¸å¤„ç†</p>
                    <p>â€¢ ç½‘ç»œè¿æ¥é”™è¯¯å¤„ç†</p>
                    <p>â€¢ ä¼˜é›…çš„é”™è¯¯å“åº”</p>
                </div>
            </div>

            <div class="file-section">
                <div class="file-header">
                    <span class="file-icon">ğŸ®</span>
                    äº¤äº’ä½“éªŒ
                </div>
                <div class="code-content">
                    <p>â€¢ åŸºæœ¬è¿ç®—æ¼”ç¤º</p>
                    <p>â€¢ æµå¼è®¡ç®—æ¼”ç¤º</p>
                    <p>â€¢ äº¤äº’å¼è®¡ç®—å™¨æ¨¡å¼</p>
                </div>
            </div>
        </div>

        <div class="command-section">
            <h3>ğŸ¯ å­¦ä¹ è¦ç‚¹</h3>
            <ol>
                <li><strong>Protocol Buffers</strong> - é«˜æ•ˆçš„åºåˆ—åŒ–æ ¼å¼ï¼Œæ¯”JSONæ›´å¿«æ›´å°</li>
                <li><strong>æœåŠ¡å®šä¹‰</strong> - ä½¿ç”¨.protoæ–‡ä»¶å®šä¹‰RPCæœåŠ¡æ¥å£</li>
                <li><strong>ä»£ç ç”Ÿæˆ</strong> - è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»£ç </li>
                <li><strong>æµå¼RPC</strong> - æ”¯æŒå®¢æˆ·ç«¯æµã€æœåŠ¡ç«¯æµå’ŒåŒå‘æµ</li>
                <li><strong>é”™è¯¯å¤„ç†</strong> - ä¼˜é›…å¤„ç†ç½‘ç»œå’Œä¸šåŠ¡å¼‚å¸¸</li>
                <li><strong>æ€§èƒ½ä¼˜åŠ¿</strong> - HTTP/2æ”¯æŒï¼ŒäºŒè¿›åˆ¶åè®®ï¼Œè¿æ¥å¤ç”¨</li>
            </ol>
        </div>
    </div>
</body>
</html>
