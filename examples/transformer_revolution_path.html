<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformeræ¶æ„æ¼”è¿›å¯è§†åŒ–</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .timeline {
            display: flex;
            justify-content: space-between;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .timeline-item {
            text-align: center;
            flex: 1;
            padding: 10px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .timeline-item:hover {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            transform: translateY(-5px);
        }
        
        .timeline-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .year {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .tech {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .demo-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .demo-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .demo-card h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .controls {
            margin-bottom: 20px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .control-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        
        .plot-container {
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .architecture-viz {
            grid-column: span 2;
        }
        
        .layer-block {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .layer-block:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .improvement-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: bold;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Transformeræ¶æ„æ¼”è¿›å¯è§†åŒ–</h1>
            <p>æ¢ç´¢ä»åŸå§‹Transformeråˆ°ç°ä»£LLMçš„å…³é”®æŠ€æœ¯çªç ´</p>
        </div>
        
        <div class="timeline">
            <div class="timeline-item active" data-year="2017">
                <div class="year">2017</div>
                <div class="tech">åŸå§‹Transformer</div>
            </div>
            <div class="timeline-item" data-year="2019">
                <div class="year">2019</div>
                <div class="tech">RMSNorm</div>
            </div>
            <div class="timeline-item" data-year="2020">
                <div class="year">2020</div>
                <div class="tech">SwiGLU</div>
            </div>
            <div class="timeline-item" data-year="2021">
                <div class="year">2021</div>
                <div class="tech">RoPE</div>
            </div>
            <div class="timeline-item" data-year="2023">
                <div class="year">2023</div>
                <div class="tech">ç°ä»£LLM</div>
            </div>
        </div>
        
        <!-- 2017: åŸå§‹Transformer -->
        <div class="demo-section" id="demo-2017">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>ğŸ“ ä½ç½®ç¼–ç ï¼šæ­£å¼¦æ³¢æ¨¡å¼</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>åºåˆ—é•¿åº¦: <span id="seq-len-value">64</span></label>
                            <input type="range" id="seq-len" min="16" max="256" value="64">
                        </div>
                        <div class="control-group">
                            <label>ç»´åº¦: <span id="d-model-value">128</span></label>
                            <input type="range" id="d-model" min="64" max="512" step="64" value="128">
                        </div>
                    </div>
                    <div class="plot-container" id="pos-encoding-plot"></div>
                </div>
                
                <div class="demo-card">
                    <h3>âš¡ æ¿€æ´»å‡½æ•°ï¼šReLUç‰¹æ€§</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>å‡½æ•°ç±»å‹:</label>
                            <select id="activation-type">
                                <option value="relu">ReLU</option>
                                <option value="gelu">GELU (æ”¹è¿›)</option>
                                <option value="swish">Swish (è¿›ä¸€æ­¥æ”¹è¿›)</option>
                                <option value="swiglu">SwiGLU (ç°ä»£)</option>
                            </select>
                        </div>
                    </div>
                    <div class="plot-container" id="activation-plot"></div>
                </div>
            </div>
            
            <div class="demo-card architecture-viz">
                <h3>ğŸ—ï¸ åŸå§‹Transformeræ¶æ„</h3>
                <div class="layer-block">
                    <strong>Post-Norm</strong><br>
                    x â†’ Attention â†’ Add & Norm â†’ FFN â†’ Add & Norm
                    <div class="improvement-badge">âš ï¸</div>
                </div>
                <div class="layer-block">
                    <strong>æ­£å¼¦ä½ç½®ç¼–ç </strong><br>
                    PE(pos,2i) = sin(pos/10000^(2i/d_model))
                    <div class="improvement-badge">âš ï¸</div>
                </div>
                <div class="layer-block">
                    <strong>ReLUæ¿€æ´» + LayerNorm</strong><br>
                    ReLU(x) = max(0,x), LN(x) = Î³(x-Î¼)/Ïƒ + Î²
                    <div class="improvement-badge">âš ï¸</div>
                </div>
            </div>
        </div>
        
        <!-- 2019: RMSNorm -->
        <div class="demo-section hidden" id="demo-2019">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>ğŸ“Š å½’ä¸€åŒ–æ–¹æ³•å¯¹æ¯”</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>å½’ä¸€åŒ–ç±»å‹:</label>
                            <select id="norm-type">
                                <option value="layernorm">LayerNorm</option>
                                <option value="rmsnorm">RMSNorm</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>è¾“å…¥å™ªå£°å¼ºåº¦: <span id="noise-level-value">0.5</span></label>
                            <input type="range" id="noise-level" min="0" max="2" step="0.1" value="0.5">
                        </div>
                    </div>
                    <div class="plot-container" id="norm-comparison-plot"></div>
                </div>
                
                <div class="demo-card">
                    <h3>âš¡ è®¡ç®—å¤æ‚åº¦åˆ†æ</h3>
                    <div class="comparison-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="layernorm-ops">100%</div>
                            <div class="metric-label">LayerNormè®¡ç®—é‡</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="rmsnorm-ops">80%</div>
                            <div class="metric-label">RMSNormè®¡ç®—é‡</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="memory-saving">15%</div>
                            <div class="metric-label">å†…å­˜èŠ‚çœ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="speed-up">20%</div>
                            <div class="metric-label">é€Ÿåº¦æå‡</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="demo-card architecture-viz">
                <h3>ğŸ”¬ RMSNormæ”¹è¿›åŸç†</h3>
                <div class="layer-block">
                    <strong>LayerNorm (åŸå§‹)</strong><br>
                    LN(x) = Î³ Â· (x - Î¼) / Ïƒ + Î²<br>
                    éœ€è¦è®¡ç®—å‡å€¼Î¼å’Œæ–¹å·®Ïƒ
                </div>
                <div class="layer-block">
                    <strong>RMSNorm (æ”¹è¿›)</strong><br>
                    RMS(x) = Î³ Â· x / âˆš(E[xÂ²])<br>
                    åªéœ€è®¡ç®—å‡æ–¹æ ¹ï¼Œæ— éœ€å‡å€¼å’Œåç½®
                    <div class="improvement-badge">âœ¨</div>
                </div>
            </div>
        </div>
        
        <!-- 2020: SwiGLU -->
        <div class="demo-section hidden" id="demo-2020">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>ğŸ”„ æ¿€æ´»å‡½æ•°æ¼”è¿›</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>å¯¹æ¯”æ¿€æ´»å‡½æ•°:</label>
                            <select id="activation-comparison">
                                <option value="all">å…¨éƒ¨å¯¹æ¯”</option>
                                <option value="relu-gelu">ReLU vs GELU</option>
                                <option value="gelu-swish">GELU vs Swish</option>
                                <option value="swish-swiglu">Swish vs SwiGLU</option>
                            </select>
                        </div>
                    </div>
                    <div class="plot-container" id="activation-evolution-plot"></div>
                </div>
                
                <div class="demo-card">
                    <h3>ğŸ“ˆ æ¢¯åº¦æµåˆ†æ</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>ç½‘ç»œæ·±åº¦: <span id="depth-value">6</span></label>
                            <input type="range" id="depth" min="2" max="12" value="6">
                        </div>
                    </div>
                    <div class="plot-container" id="gradient-flow-plot"></div>
                </div>
            </div>
            
            <div class="demo-card architecture-viz">
                <h3>ğŸ§¬ SwiGLUé—¨æ§æœºåˆ¶</h3>
                <div class="layer-block">
                    <strong>ReLU FFN (åŸå§‹)</strong><br>
                    FFN(x) = max(0, xWâ‚ + bâ‚)Wâ‚‚ + bâ‚‚
                </div>
                <div class="layer-block">
                    <strong>SwiGLU FFN (æ”¹è¿›)</strong><br>
                    SwiGLU(x) = (Swish(xWâ‚) âŠ™ xWâ‚‚)Wâ‚ƒ<br>
                    å¼•å…¥æ˜¾å¼é—¨æ§æœºåˆ¶
                    <div class="improvement-badge">ğŸš€</div>
                </div>
            </div>
        </div>
        
        <!-- 2021: RoPE -->
        <div class="demo-section hidden" id="demo-2021">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>ğŸŒ€ æ—‹è½¬ä½ç½®ç¼–ç  (RoPE)</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>åºåˆ—é•¿åº¦: <span id="rope-seq-len-value">128</span></label>
                            <input type="range" id="rope-seq-len" min="32" max="512" value="128">
                        </div>
                        <div class="control-group">
                            <label>ç›¸å¯¹ä½ç½®è·ç¦»: <span id="relative-pos-value">10</span></label>
                            <input type="range" id="relative-pos" min="1" max="50" value="10">
                        </div>
                    </div>
                    <div class="plot-container" id="rope-plot"></div>
                </div>
                
                <div class="demo-card">
                    <h3>ğŸ“ é•¿åºåˆ—å¤–æ¨èƒ½åŠ›</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>è®­ç»ƒé•¿åº¦: <span id="train-len-value">512</span></label>
                            <input type="range" id="train-len" min="256" max="1024" step="128" value="512">
                        </div>
                        <div class="control-group">
                            <label>æµ‹è¯•é•¿åº¦: <span id="test-len-value">1024</span></label>
                            <input type="range" id="test-len" min="512" max="4096" step="256" value="1024">
                        </div>
                    </div>
                    <div class="plot-container" id="extrapolation-plot"></div>
                </div>
            </div>
            
            <div class="demo-card architecture-viz">
                <h3>ğŸ¯ RoPEæ ¸å¿ƒä¼˜åŠ¿</h3>
                <div class="layer-block">
                    <strong>æ­£å¼¦ä½ç½®ç¼–ç é—®é¢˜</strong><br>
                    â€¢ ç»å¯¹ä½ç½®ç¼–ç ï¼Œç›¸å¯¹ä½ç½®ä¿¡æ¯å¼±<br>
                    â€¢ é•¿åºåˆ—å¤–æ¨èƒ½åŠ›å·®<br>
                    â€¢ ä½ç½®ä¿¡æ¯ä¸å†…å®¹ä¿¡æ¯åˆ†ç¦»
                </div>
                <div class="layer-block">
                    <strong>RoPEè§£å†³æ–¹æ¡ˆ</strong><br>
                    â€¢ ç›¸å¯¹ä½ç½®ç¼–ç ï¼Œå†…ç§¯ä¿æŒç›¸å¯¹å…³ç³»<br>
                    â€¢ ä¼˜ç§€çš„é•¿åºåˆ—å¤–æ¨èƒ½åŠ›<br>
                    â€¢ ä½ç½®ä¿¡æ¯èå…¥æ³¨æ„åŠ›è®¡ç®—
                    <div class="improvement-badge">ğŸ¯</div>
                </div>
            </div>
        </div>
        
        <!-- 2023: ç°ä»£LLM -->
        <div class="demo-section hidden" id="demo-2023">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>ğŸ›ï¸ æ¶æ„å¯¹æ¯”ï¼šPost-Norm vs Pre-Norm</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>æ¶æ„ç±»å‹:</label>
                            <select id="norm-position">
                                <option value="post">Post-Norm (åŸå§‹)</option>
                                <option value="pre">Pre-Norm (ç°ä»£)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>ç½‘ç»œå±‚æ•°: <span id="num-layers-value">12</span></label>
                            <input type="range" id="num-layers" min="6" max="24" value="12">
                        </div>
                    </div>
                    <div class="plot-container" id="norm-position-plot"></div>
                </div>
                
                <div class="demo-card">
                    <h3>ğŸ“Š ç»¼åˆæ€§èƒ½æå‡</h3>
                    <div class="comparison-grid">
                        <div class="metric-card">
                            <div class="metric-value">40%</div>
                            <div class="metric-label">è®­ç»ƒé€Ÿåº¦æå‡</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">25%</div>
                            <div class="metric-label">è®¡ç®—æ•ˆç‡æå‡</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">8x</div>
                            <div class="metric-label">é•¿åºåˆ—å¤„ç†èƒ½åŠ›</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">15%</div>
                            <div class="metric-label">æ¨¡å‹æ€§èƒ½æå‡</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="demo-card architecture-viz">
                <h3>ğŸ‰ ç°ä»£LLMæœ€ç»ˆå½¢æ€</h3>
                <div class="layer-block">
                    <strong>Pre-Norm + RMSNorm</strong><br>
                    x â†’ RMSNorm â†’ Attention â†’ Add
                    <div class="improvement-badge">âœ…</div>
                </div>
                <div class="layer-block">
                    <strong>RoPEä½ç½®ç¼–ç </strong><br>
                    ç›¸å¯¹ä½ç½®ç¼–ç ï¼Œä¼˜ç§€å¤–æ¨èƒ½åŠ›
                    <div class="improvement-badge">âœ…</div>
                </div>
                <div class="layer-block">
                    <strong>SwiGLUæ¿€æ´»</strong><br>
                    é—¨æ§æœºåˆ¶ï¼Œæ›´å¼ºè¡¨è¾¾èƒ½åŠ›
                    <div class="improvement-badge">âœ…</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let currentYear = "2017";
        
        // æ—¶é—´çº¿åˆ‡æ¢
        document.querySelectorAll('.timeline-item').forEach(item => {
            item.addEventListener('click', () => {
                // æ›´æ–°æ´»è·ƒçŠ¶æ€
                document.querySelectorAll('.timeline-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                // éšè—æ‰€æœ‰æ¼”ç¤ºåŒºåŸŸ
                document.querySelectorAll('.demo-section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // æ˜¾ç¤ºå½“å‰å¹´ä»½çš„æ¼”ç¤º
                currentYear = item.dataset.year;
                document.getElementById(`demo-${currentYear}`).classList.remove('hidden');
                
                // åˆå§‹åŒ–å¯¹åº”çš„å¯è§†åŒ–
                initVisualization(currentYear);
            });
        });
        
        // åˆå§‹åŒ–å¯è§†åŒ–
        function initVisualization(year) {
            switch(year) {
                case "2017":
                    initOriginalTransformer();
                    break;
                case "2019":
                    initRMSNorm();
                    break;
                case "2020":
                    initSwiGLU();
                    break;
                case "2021":
                    initRoPE();
                    break;
                case "2023":
                    initModernLLM();
                    break;
            }
        }
        
        // 2017: åŸå§‹Transformer
        function initOriginalTransformer() {
            // ä½ç½®ç¼–ç å¯è§†åŒ–
            function updatePositionalEncoding() {
                const seqLen = parseInt(document.getElementById('seq-len').value);
                const dModel = parseInt(document.getElementById('d-model').value);
                
                document.getElementById('seq-len-value').textContent = seqLen;
                document.getElementById('d-model-value').textContent = dModel;
                
                const positions = Array.from({length: seqLen}, (_, i) => i);
                const dimensions = Array.from({length: Math.min(8, dModel)}, (_, i) => i);
                
                const data = dimensions.map(dim => ({
                    x: positions,
                    y: positions.map(pos => {
                        if (dim % 2 === 0) {
                            return Math.sin(pos / Math.pow(10000, 2 * dim / dModel));
                        } else {
                            return Math.cos(pos / Math.pow(10000, 2 * (dim-1) / dModel));
                        }
                    }),
                    name: `ç»´åº¦ ${dim}`,
                    type: 'scatter',
                    mode: 'lines'
                }));
                
                Plotly.newPlot('pos-encoding-plot', data, {
                    title: 'æ­£å¼¦ä½ç½®ç¼–ç æ¨¡å¼',
                    xaxis: { title: 'ä½ç½®' },
                    yaxis: { title: 'ç¼–ç å€¼' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            // æ¿€æ´»å‡½æ•°å¯è§†åŒ–
            function updateActivation() {
                const activationType = document.getElementById('activation-type').value;
                const x = Array.from({length: 200}, (_, i) => (i - 100) / 20);
                
                let y, name, color;
                switch(activationType) {
                    case 'relu':
                        y = x.map(val => Math.max(0, val));
                        name = 'ReLU';
                        color = '#ff6b6b';
                        break;
                    case 'gelu':
                        y = x.map(val => val * 0.5 * (1 + Math.tanh(Math.sqrt(2/Math.PI) * (val + 0.044715 * Math.pow(val, 3)))));
                        name = 'GELU';
                        color = '#4ecdc4';
                        break;
                    case 'swish':
                        y = x.map(val => val / (1 + Math.exp(-val)));
                        name = 'Swish';
                        color = '#45b7d1';
                        break;
                    case 'swiglu':
                        y = x.map(val => (val / (1 + Math.exp(-val))) * val);
                        name = 'SwiGLU (ç®€åŒ–)';
                        color = '#96ceb4';
                        break;
                }
                
                const data = [{
                    x: x,
                    y: y,
                    type: 'scatter',
                    mode: 'lines',
                    name: name,
                    line: { color: color, width: 3 }
                }];
                
                Plotly.newPlot('activation-plot', data, {
                    title: `${name} æ¿€æ´»å‡½æ•°`,
                    xaxis: { title: 'è¾“å…¥å€¼' },
                    yaxis: { title: 'è¾“å‡ºå€¼' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            document.getElementById('seq-len').addEventListener('input', updatePositionalEncoding);
            document.getElementById('d-model').addEventListener('input', updatePositionalEncoding);
            document.getElementById('activation-type').addEventListener('change', updateActivation);
            
            // åˆå§‹åŒ–å›¾è¡¨
            updatePositionalEncoding();
            updateActivation();
        }
        
        // 2019: RMSNorm
        function initRMSNorm() {
            function updateNormComparison() {
                const normType = document.getElementById('norm-type').value;
                const noiseLevel = parseFloat(document.getElementById('noise-level').value);
                
                document.getElementById('noise-level-value').textContent = noiseLevel;
                
                // ç”Ÿæˆå¸¦å™ªå£°çš„è¾“å…¥æ•°æ®
                const x = Array.from({length: 100}, (_, i) => i);
                const cleanSignal = x.map(i => Math.sin(i * 0.1));
                const noisySignal = cleanSignal.map(val => val + (Math.random() - 0.5) * noiseLevel);
                
                // å½’ä¸€åŒ–å¤„ç†
                let normalizedSignal;
                if (normType === 'layernorm') {
                    const mean = noisySignal.reduce((a, b) => a + b) / noisySignal.length;
                    const variance = noisySignal.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / noisySignal.length;
                    const std = Math.sqrt(variance);
                    normalizedSignal = noisySignal.map(val => (val - mean) / (std + 1e-6));
                } else {
                    const rms = Math.sqrt(noisySignal.reduce((sum, val) => sum + val * val, 0) / noisySignal.length);
                    normalizedSignal = noisySignal.map(val => val / (rms + 1e-6));
                }
                
                const data = [
                    {
                        x: x,
                        y: noisySignal,
                        name: 'åŸå§‹ä¿¡å·',
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#ff6b6b', width: 2 }
                    },
                    {
                        x: x,
                        y: normalizedSignal,
                        name: `${normType === 'layernorm' ? 'LayerNorm' : 'RMSNorm'} å¤„ç†å`,
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#4ecdc4', width: 2 }
                    }
                ];
                
                Plotly.newPlot('norm-comparison-plot', data, {
                    title: 'å½’ä¸€åŒ–æ•ˆæœå¯¹æ¯”',
                    xaxis: { title: 'æ—¶é—´æ­¥' },
                    yaxis: { title: 'æ•°å€¼' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            document.getElementById('norm-type').addEventListener('change', updateNormComparison);
            document.getElementById('noise-level').addEventListener('input', updateNormComparison);
            
            updateNormComparison();
        }
        
        // 2020: SwiGLU
        function initSwiGLU() {
            function updateActivationEvolution() {
                const comparison = document.getElementById('activation-comparison').value;
                const x = Array.from({length: 200}, (_, i) => (i - 100) / 20);
                
                const activations = {
                    relu: { 
                        y: x.map(val => Math.max(0, val)),
                        color: '#ff6b6b',
                        name: 'ReLU'
                    },
                    gelu: {
                        y: x.map(val => val * 0.5 * (1 + Math.tanh(Math.sqrt(2/Math.PI) * (val + 0.044715 * Math.pow(val, 3))))),
                        color: '#4ecdc4',
                        name: 'GELU'
                    },
                    swish: {
                        y: x.map(val => val / (1 + Math.exp(-val))),
                        color: '#45b7d1',
                        name: 'Swish'
                    },
                    swiglu: {
                        y: x.map(val => (val / (1 + Math.exp(-val))) * val),
                        color: '#96ceb4',
                        name: 'SwiGLU'
                    }
                };
                
                let data = [];
                if (comparison === 'all') {
                    data = Object.values(activations).map(act => ({
                        x: x,
                        y: act.y,
                        type: 'scatter',
                        mode: 'lines',
                        name: act.name,
                        line: { color: act.color, width: 3 }
                    }));
                } else {
                    const [first, second] = comparison.split('-');
                    data = [activations[first], activations[second]].map(act => ({
                        x: x,
                        y: act.y,
                        type: 'scatter',
                        mode: 'lines',
                        name: act.name,
                        line: { color: act.color, width: 3 }
                    }));
                }
                
                Plotly.newPlot('activation-evolution-plot', data, {
                    title: 'æ¿€æ´»å‡½æ•°æ¼”è¿›å¯¹æ¯”',
                    xaxis: { title: 'è¾“å…¥å€¼' },
                    yaxis: { title: 'è¾“å‡ºå€¼' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            function updateGradientFlow() {
                const depth = parseInt(document.getElementById('depth').value);
                document.getElementById('depth-value').textContent = depth;
                
                const layers = Array.from({length: depth}, (_, i) => i + 1);
                
                // æ¨¡æ‹Ÿä¸åŒæ¿€æ´»å‡½æ•°çš„æ¢¯åº¦æµ
                const gradientFlows = {
                    relu: layers.map(layer => Math.pow(0.8, layer - 1)),
                    gelu: layers.map(layer => Math.pow(0.85, layer - 1)),
                    swish: layers.map(layer => Math.pow(0.9, layer - 1)),
                    swiglu: layers.map(layer => Math.pow(0.95, layer - 1))
                };
                
                const data = Object.entries(gradientFlows).map(([name, flow]) => ({
                    x: layers,
                    y: flow,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: name.toUpperCase(),
                    line: { width: 3 }
                }));
                
                Plotly.newPlot('gradient-flow-plot', data, {
                    title: 'æ¢¯åº¦æµè¡°å‡å¯¹æ¯”',
                    xaxis: { title: 'ç½‘ç»œå±‚æ•°' },
                    yaxis: { title: 'æ¢¯åº¦å¼ºåº¦', type: 'log' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            document.getElementById('activation-comparison').addEventListener('change', updateActivationEvolution);
            document.getElementById('depth').addEventListener('input', updateGradientFlow);
            
            updateActivationEvolution();
            updateGradientFlow();
        }
        
        // 2021: RoPE
        function initRoPE() {
            function updateRoPE() {
                const seqLen = parseInt(document.getElementById('rope-seq-len').value);
                const relativePos = parseInt(document.getElementById('relative-pos').value);
                
                document.getElementById('rope-seq-len-value').textContent = seqLen;
                document.getElementById('relative-pos-value').textContent = relativePos;
                
                // ç”ŸæˆRoPEç›¸å…³æ€§çŸ©é˜µ
                const positions = Array.from({length: seqLen}, (_, i) => i);
                const correlation = positions.map(i => 
                    positions.map(j => Math.cos(Math.abs(i - j) * Math.PI / 64))
                );
                
                const data = [{
                    z: correlation,
                    x: positions,
                    y: positions,
                    type: 'heatmap',
                    colorscale: 'Viridis'
                }];
                
                Plotly.newPlot('rope-plot', data, {
                    title: 'RoPEä½ç½®ç›¸å…³æ€§çŸ©é˜µ',
                    xaxis: { title: 'ä½ç½®i' },
                    yaxis: { title: 'ä½ç½®j' },
                    margin: { t: 40, r: 60, b: 40, l: 40 }
                });
            }
            
            function updateExtrapolation() {
                const trainLen = parseInt(document.getElementById('train-len').value);
                const testLen = parseInt(document.getElementById('test-len').value);
                
                document.getElementById('train-len-value').textContent = trainLen;
                document.getElementById('test-len-value').textContent = testLen;
                
                const positions = Array.from({length: testLen}, (_, i) => i);
                
                // æ¨¡æ‹Ÿæ€§èƒ½è¡°å‡
                const sinusoidalPerf = positions.map(pos => {
                    if (pos <= trainLen) return 1.0;
                    return Math.max(0.3, 1.0 - (pos - trainLen) / trainLen * 0.8);
                });
                
                const ropePerf = positions.map(pos => {
                    if (pos <= trainLen) return 1.0;
                    return Math.max(0.7, 1.0 - (pos - trainLen) / trainLen * 0.3);
                });
                
                const data = [
                    {
                        x: positions,
                        y: sinusoidalPerf,
                        name: 'æ­£å¼¦ä½ç½®ç¼–ç ',
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#ff6b6b', width: 3 }
                    },
                    {
                        x: positions,
                        y: ropePerf,
                        name: 'RoPE',
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#4ecdc4', width: 3 }
                    },
                    {
                        x: [trainLen, trainLen],
                        y: [0, 1],
                        name: 'è®­ç»ƒé•¿åº¦è¾¹ç•Œ',
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#666', dash: 'dash' }
                    }
                ];
                
                Plotly.newPlot('extrapolation-plot', data, {
                    title: 'é•¿åºåˆ—å¤–æ¨èƒ½åŠ›å¯¹æ¯”',
                    xaxis: { title: 'åºåˆ—é•¿åº¦' },
                    yaxis: { title: 'æ€§èƒ½ä¿æŒç‡' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            document.getElementById('rope-seq-len').addEventListener('input', updateRoPE);
            document.getElementById('relative-pos').addEventListener('input', updateRoPE);
            document.getElementById('train-len').addEventListener('input', updateExtrapolation);
            document.getElementById('test-len').addEventListener('input', updateExtrapolation);
            
            updateRoPE();
            updateExtrapolation();
        }
        
        // 2023: ç°ä»£LLM
        function initModernLLM() {
            function updateNormPosition() {
                const normPosition = document.getElementById('norm-position').value;
                const numLayers = parseInt(document.getElementById('num-layers').value);
                
                document.getElementById('num-layers-value').textContent = numLayers;
                
                const epochs = Array.from({length: 100}, (_, i) => i + 1);
                
                // æ¨¡æ‹Ÿè®­ç»ƒç¨³å®šæ€§
                const postNormLoss = epochs.map(epoch => {
                    const base = 2.0 * Math.exp(-epoch / 30);
                    const noise = Math.sin(epoch * 0.3) * 0.2 * Math.exp(-epoch / 20);
                    return Math.max(0.1, base + noise);
                });
                
                const preNormLoss = epochs.map(epoch => {
                    const base = 2.0 * Math.exp(-epoch / 20);
                    const noise = Math.sin(epoch * 0.1) * 0.1 * Math.exp(-epoch / 30);
                    return Math.max(0.05, base + noise);
                });
                
                const data = [
                    {
                        x: epochs,
                        y: normPosition === 'post' ? postNormLoss : preNormLoss,
                        name: normPosition === 'post' ? 'Post-Norm' : 'Pre-Norm',
                        type: 'scatter',
                        mode: 'lines',
                        line: { 
                            color: normPosition === 'post' ? '#ff6b6b' : '#4ecdc4',
                            width: 3 
                        }
                    }
                ];
                
                if (normPosition === 'pre') {
                    data.push({
                        x: epochs,
                        y: postNormLoss,
                        name: 'Post-Norm (å¯¹æ¯”)',
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#ff6b6b', width: 2, dash: 'dash' },
                        opacity: 0.5
                    });
                }
                
                Plotly.newPlot('norm-position-plot', data, {
                    title: 'è®­ç»ƒç¨³å®šæ€§å¯¹æ¯”',
                    xaxis: { title: 'è®­ç»ƒè½®æ¬¡' },
                    yaxis: { title: 'æŸå¤±å€¼', type: 'log' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            document.getElementById('norm-position').addEventListener('change', updateNormPosition);
            document.getElementById('num-layers').addEventListener('input', updateNormPosition);
            
            updateNormPosition();
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initVisualization(currentYear);
        });
    </script>
</body>
</html>
