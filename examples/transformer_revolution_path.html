<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransformerÊû∂ÊûÑÊºîËøõÂèØËßÜÂåñ - Â¢ûÂº∫Áâà</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .timeline {
            display: flex;
            justify-content: space-between;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .timeline-item {
            text-align: center;
            flex: 1;
            padding: 10px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .timeline-item:hover {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            transform: translateY(-5px);
        }
        
        .timeline-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .year {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .tech {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .demo-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .demo-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .demo-card h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .controls {
            margin-bottom: 20px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .control-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        
        .plot-container {
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .architecture-viz {
            grid-column: span 2;
        }
        
        .layer-block {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .layer-block:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .improvement-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: bold;
        }
        
        .formula-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        
        .formula-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .code-section {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .toggle-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .toggle-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            background: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-btn.active {
            background: #667eea;
            color: white;
        }
        
        .toggle-content {
            display: none;
        }
        
        .toggle-content.active {
            display: block;
        }
        
        .hidden {
            display: none;
        }
        
        /* MathJaxÊ†∑Âºè */
        .MathJax {
            font-size: 1.1em !important;
        }
        
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-item {
            border-radius: 10px;
            padding: 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .comparison-item.before {
            background: linear-gradient(135deg, #ffcccc 0%, #ffe6e6 100%);
            border-color: #ff6b6b;
        }
        
        .comparison-item.after {
            background: linear-gradient(135deg, #ccffcc 0%, #e6ffe6 100%);
            border-color: #4ecdc4;
        }
        
        .comparison-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ TransformerÊû∂ÊûÑÊºîËøõÂèØËßÜÂåñ - Â¢ûÂº∫Áâà</h1>
            <p>Êé¢Á¥¢‰ªéÂéüÂßãTransformerÂà∞Áé∞‰ª£LLMÁöÑÂÖ≥ÈîÆÊäÄÊúØÁ™ÅÁ†¥</p>
        </div>
        
        <div class="timeline">
            <div class="timeline-item active" data-year="2017">
                <div class="year">2017</div>
                <div class="tech">ÂéüÂßãTransformer</div>
            </div>
            <div class="timeline-item" data-year="2019">
                <div class="year">2019</div>
                <div class="tech">RMSNorm</div>
            </div>
            <div class="timeline-item" data-year="2020">
                <div class="year">2020</div>
                <div class="tech">SwiGLU</div>
            </div>
            <div class="timeline-item" data-year="2021">
                <div class="year">2021</div>
                <div class="tech">RoPE</div>
            </div>
            <div class="timeline-item" data-year="2023">
                <div class="year">2023</div>
                <div class="tech">Áé∞‰ª£LLM</div>
            </div>
        </div>
        
        <!-- 2017: ÂéüÂßãTransformer -->
        <div class="demo-section" id="demo-2017">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>üìç ‰ΩçÁΩÆÁºñÁ†ÅÔºöÊ≠£Âº¶Ê≥¢Ê®°Âºè</h3>
                    
                    <div class="formula-section">
                        <div class="formula-title">Ê≠£Âº¶‰ΩçÁΩÆÁºñÁ†ÅÂÖ¨ÂºèÔºö</div>
                        <div id="sinusoidal-formula">
                            $$PE_{(pos, 2i)} = \sin\left(\frac{pos}{10000^{2i/d_{model}}}\right)$$
                            $$PE_{(pos, 2i+1)} = \cos\left(\frac{pos}{10000^{2i/d_{model}}}\right)$$
                        </div>
                    </div>
                    
                    <div class="toggle-buttons">
                        <button class="toggle-btn active" onclick="toggleContent('sin-viz', this)">ÂèØËßÜÂåñ</button>
                        <button class="toggle-btn" onclick="toggleContent('sin-code', this)">‰ª£Á†ÅÁ§∫‰æã</button>
                    </div>
                    
                    <div class="toggle-content active" id="sin-viz">
                        <div class="controls">
                            <div class="control-group">
                                <label>Â∫èÂàóÈïøÂ∫¶: <span id="seq-len-value">64</span></label>
                                <input type="range" id="seq-len" min="16" max="256" value="64">
                            </div>
                            <div class="control-group">
                                <label>Áª¥Â∫¶: <span id="d-model-value">128</span></label>
                                <input type="range" id="d-model" min="64" max="512" step="64" value="128">
                            </div>
                        </div>
                        <div class="plot-container" id="pos-encoding-plot"></div>
                    </div>
                    
                    <div class="toggle-content" id="sin-code">
                        <div class="code-section">
import torch
import math

def sinusoidal_positional_encoding(max_len, d_model):
    pe = torch.zeros(max_len, d_model)
    position = torch.arange(0, max_len).unsqueeze(1).float()
    
    div_term = torch.exp(torch.arange(0, d_model, 2).float() * 
                        -(math.log(10000.0) / d_model))
    
    pe[:, 0::2] = torch.sin(position * div_term)
    pe[:, 1::2] = torch.cos(position * div_term)
    
    return pe

# Á§∫‰æã‰ΩøÁî®
pos_encoding = sinusoidal_positional_encoding(512, 256)
print(f"‰ΩçÁΩÆÁºñÁ†ÅÂΩ¢Áä∂: {pos_encoding.shape}")
                        </div>
                    </div>
                </div>
                
                <div class="demo-card">
                    <h3>‚ö° ÊøÄÊ¥ªÂáΩÊï∞ÔºöReLUÁâπÊÄß</h3>
                    
                    <div class="formula-section">
                        <div class="formula-title">ReLUÂáΩÊï∞ÂÖ¨ÂºèÔºö</div>
                        <div id="relu-formula">
                            $$\text{ReLU}(x) = \max(0, x)$$
                        </div>
                    </div>
                    
                    <div class="toggle-buttons">
                        <button class="toggle-btn active" onclick="toggleContent('relu-viz', this)">ÂèØËßÜÂåñ</button>
                        <button class="toggle-btn" onclick="toggleContent('relu-code', this)">‰ª£Á†ÅÁ§∫‰æã</button>
                    </div>
                    
                    <div class="toggle-content active" id="relu-viz">
                        <div class="controls">
                            <div class="control-group">
                                <label>ÂáΩÊï∞Á±ªÂûã:</label>
                                <select id="activation-type">
                                    <option value="relu">ReLU</option>
                                    <option value="gelu">GELU (ÊîπËøõ)</option>
                                    <option value="swish">Swish (Ëøõ‰∏ÄÊ≠•ÊîπËøõ)</option>
                                    <option value="swiglu">SwiGLU (Áé∞‰ª£)</option>
                                </select>
                            </div>
                        </div>
                        <div class="plot-container" id="activation-plot"></div>
                    </div>
                    
                    <div class="toggle-content" id="relu-code">
                        <div class="code-section">
import torch
import torch.nn.functional as F

def relu(x):
    return torch.max(torch.zeros_like(x), x)

def gelu(x):
    return 0.5 * x * (1 + torch.tanh(
        torch.sqrt(torch.tensor(2.0 / math.pi)) * 
        (x + 0.044715 * torch.pow(x, 3))
    ))

def swish(x):
    return x * torch.sigmoid(x)

# Á§∫‰æã
x = torch.randn(100)
relu_out = relu(x)
gelu_out = gelu(x)
swish_out = swish(x)
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="demo-card architecture-viz">
                <h3>üèóÔ∏è ÂéüÂßãTransformerÊû∂ÊûÑ - Post-Norm</h3>
                
                <div class="formula-section">
                    <div class="formula-title">Post-NormËÆ°ÁÆóÊµÅÁ®ãÔºö</div>
                    <div id="postnorm-formula">
                        $$\text{Output} = \text{LayerNorm}(x + \text{Sublayer}(x))$$
                        $$\text{LayerNorm}(x) = \gamma \cdot \frac{x - \mu}{\sigma} + \beta$$
                        <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        ÂÖ∂‰∏≠ $\mu$ ÊòØÂùáÂÄºÔºå$\sigma$ ÊòØÊ†áÂáÜÂ∑ÆÔºà‰∏çÊòØÊñπÂ∑ÆÔºâ
                        </p>
                    </div>
                </div>
                
                <div class="layer-block">
                    <strong>Post-NormÁªìÊûÑÈóÆÈ¢ò</strong><br>
                    x ‚Üí Attention ‚Üí Add ‚Üí Norm ‚Üí FFN ‚Üí Add ‚Üí Norm
                    <div class="improvement-badge">‚ö†Ô∏è</div>
                </div>
            </div>
        </div>
        
        <!-- 2019: RMSNorm -->
        <div class="demo-section hidden" id="demo-2019">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>üìä ÂΩí‰∏ÄÂåñÊñπÊ≥ïÂØπÊØî</h3>
                    
                    <div class="comparison-container">
                        <div class="comparison-item before">
                            <div class="comparison-title">LayerNorm (ÂéüÂßã)</div>
                            <div class="formula-section">
                                <div id="layernorm-formula">
                                    $$\text{LayerNorm}(x) = \gamma \cdot \frac{x - \mu}{\sigma} + \beta$$
                                    $$\mu = \frac{1}{d}\sum_{i=1}^{d} x_i$$
                                    $$\sigma = \sqrt{\frac{1}{d}\sum_{i=1}^{d} (x_i - \mu)^2}$$
                                </div>
                            </div>
                        </div>
                        <div class="comparison-item after">
                            <div class="comparison-title">RMSNorm (ÊîπËøõ)</div>
                            <div class="formula-section">
                                <div id="rmsnorm-formula">
                                    $$\text{RMSNorm}(x) = \gamma \cdot \frac{x}{\text{RMS}(x)}$$
                                    $$\text{RMS}(x) = \sqrt{\frac{1}{d}\sum_{i=1}^{d} x_i^2}$$
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="toggle-buttons">
                        <button class="toggle-btn active" onclick="toggleContent('norm-viz', this)">ÂèØËßÜÂåñÂØπÊØî</button>
                        <button class="toggle-btn" onclick="toggleContent('norm-code', this)">‰ª£Á†ÅÂØπÊØî</button>
                    </div>
                    
                    <div class="toggle-content active" id="norm-viz">
                        <div class="controls">
                            <div class="control-group">
                                <label>ÂΩí‰∏ÄÂåñÁ±ªÂûã:</label>
                                <select id="norm-type">
                                    <option value="layernorm">LayerNorm</option>
                                    <option value="rmsnorm">RMSNorm</option>
                                    <option value="both">ÂØπÊØîÊòæÁ§∫</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>ËæìÂÖ•Âô™Â£∞Âº∫Â∫¶: <span id="noise-level-value">0.5</span></label>
                                <input type="range" id="noise-level" min="0" max="2" step="0.1" value="0.5">
                            </div>
                        </div>
                        <div class="plot-container" id="norm-comparison-plot"></div>
                    </div>
                    
                    <div class="toggle-content" id="norm-code">
                        <div class="comparison-container">
                            <div class="comparison-item before">
                                <div class="comparison-title">LayerNormÂÆûÁé∞</div>
                                <div class="code-section">
class LayerNorm(nn.Module):
    def __init__(self, dim, eps=1e-6):
        super().__init__()
        self.gamma = nn.Parameter(torch.ones(dim))
        self.beta = nn.Parameter(torch.zeros(dim))
        self.eps = eps
    
    def forward(self, x):
        mean = x.mean(-1, keepdim=True)
        var = x.var(-1, keepdim=True, unbiased=False)
        std = (var + self.eps).sqrt()
        return self.gamma * (x - mean) / std + self.beta
                                </div>
                            </div>
                            <div class="comparison-item after">
                                <div class="comparison-title">RMSNormÂÆûÁé∞</div>
                                <div class="code-section">
class RMSNorm(nn.Module):
    def __init__(self, dim, eps=1e-6):
        super().__init__()
        self.gamma = nn.Parameter(torch.ones(dim))
        self.eps = eps
    
    def forward(self, x):
        rms = x.norm(dim=-1, keepdim=True) / math.sqrt(x.size(-1))
        return self.gamma * x / (rms + self.eps)
        
# ËÆ°ÁÆóÂ§çÊùÇÂ∫¶Èôç‰ΩéÁ∫¶15-20%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="demo-card">
                    <h3>‚ö° ÊÄßËÉΩÊèêÂçáÂàÜÊûê</h3>
                    <div class="comparison-grid">
                        <div class="metric-card">
                            <div class="metric-value">100%</div>
                            <div class="metric-label">LayerNormËÆ°ÁÆóÈáè</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">80%</div>
                            <div class="metric-label">RMSNormËÆ°ÁÆóÈáè</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">15%</div>
                            <div class="metric-label">ÂÜÖÂ≠òËäÇÁúÅ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">20%</div>
                            <div class="metric-label">ÈÄüÂ∫¶ÊèêÂçá</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 2020: SwiGLU -->
        <div class="demo-section hidden" id="demo-2020">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>üîÑ ÊøÄÊ¥ªÂáΩÊï∞ÊºîËøõ</h3>
                    
                    <div class="formula-section">
                        <div class="formula-title">SwiGLUÂÖ¨ÂºèÔºö</div>
                        <div id="swiglu-formula">
                            $$\text{SwiGLU}(x) = \text{Swish}(xW_1) \odot (xW_2) \cdot W_3$$
                            $$\text{Swish}(x) = x \cdot \sigma(x) = \frac{x}{1 + e^{-x}}$$
                        </div>
                    </div>
                    
                    <div class="toggle-buttons">
                        <button class="toggle-btn active" onclick="toggleContent('swiglu-viz', this)">ÊºîËøõÂèØËßÜÂåñ</button>
                        <button class="toggle-btn" onclick="toggleContent('swiglu-code', this)">‰ª£Á†ÅÂØπÊØî</button>
                    </div>
                    
                    <div class="toggle-content active" id="swiglu-viz">
                        <div class="controls">
                            <div class="control-group">
                                <label>ÂØπÊØîÊøÄÊ¥ªÂáΩÊï∞:</label>
                                <select id="activation-comparison">
                                    <option value="all">ÂÖ®ÈÉ®ÂØπÊØî</option>
                                    <option value="relu-gelu">ReLU vs GELU</option>
                                    <option value="gelu-swish">GELU vs Swish</option>
                                    <option value="swish-swiglu">Swish vs SwiGLU</option>
                                </select>
                            </div>
                        </div>
                        <div class="plot-container" id="activation-evolution-plot"></div>
                    </div>
                    
                    <div class="toggle-content" id="swiglu-code">
                        <div class="comparison-container">
                            <div class="comparison-item before">
                                <div class="comparison-title">ReLU FFN (ÂéüÂßã)</div>
                                <div class="code-section">
class ReLUFFN(nn.Module):
    def __init__(self, dim, hidden_dim):
        super().__init__()
        self.w1 = nn.Linear(dim, hidden_dim)
        self.w2 = nn.Linear(hidden_dim, dim)
    
    def forward(self, x):
        return self.w2(F.relu(self.w1(x)))
                                </div>
                            </div>
                            <div class="comparison-item after">
                                <div class="comparison-title">SwiGLU FFN (Áé∞‰ª£)</div>
                                <div class="code-section">
class SwiGLU(nn.Module):
    def __init__(self, dim, hidden_dim):
        super().__init__()
        self.w1 = nn.Linear(dim, hidden_dim, bias=False)
        self.w2 = nn.Linear(dim, hidden_dim, bias=False)
        self.w3 = nn.Linear(hidden_dim, dim, bias=False)
    
    def forward(self, x):
        gate = F.silu(self.w1(x))  # SwishÊøÄÊ¥ª
        value = self.w2(x)
        return self.w3(gate * value)  # Èó®ÊéßÊú∫Âà∂
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="demo-card">
                    <h3>üìà Ê¢ØÂ∫¶ÊµÅÂàÜÊûê</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>ÁΩëÁªúÊ∑±Â∫¶: <span id="depth-value">6</span></label>
                            <input type="range" id="depth" min="2" max="12" value="6">
                        </div>
                    </div>
                    <div class="plot-container" id="gradient-flow-plot"></div>
                </div>
            </div>
        </div>
        
        <!-- 2021: RoPE -->
        <div class="demo-section hidden" id="demo-2021">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>üåÄ ‰ΩçÁΩÆÁºñÁ†ÅÂØπÊØîÔºöSinusoidal vs RoPE</h3>
                    
                    <div class="comparison-container">
                        <div class="comparison-item before">
                            <div class="comparison-title">Sinusoidal (ÂéüÂßã)</div>
                            <div class="formula-section">
                                <div id="sin-pos-formula">
                                    $$PE_{(pos, 2i)} = \sin\left(\frac{pos}{10000^{2i/d}}\right)$$
                                    $$PE_{(pos, 2i+1)} = \cos\left(\frac{pos}{10000^{2i/d}}\right)$$
                                </div>
                            </div>
                        </div>
                        <div class="comparison-item after">
                            <div class="comparison-title">RoPE (ÊîπËøõ)</div>
                            <div class="formula-section">
                                <div id="rope-pos-formula">
                                    $$q_m = R_m \cdot q$$
                                    $$k_m = R_m \cdot k$$
                                    $$R_m = \begin{pmatrix} \cos(m\theta) & -\sin(m\theta) \\ \sin(m\theta) & \cos(m\theta) \end{pmatrix}$$
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="toggle-buttons">
                        <button class="toggle-btn active" onclick="toggleContent('rope-viz', this)">ÂØπÊØîÂèØËßÜÂåñ</button>
                        <button class="toggle-btn" onclick="toggleContent('rope-code', this)">‰ª£Á†ÅÂØπÊØî</button>
                    </div>
                    
                    <div class="toggle-content active" id="rope-viz">
                        <div class="controls">
                            <div class="control-group">
                                <label>‰ΩçÁΩÆÁºñÁ†ÅÁ±ªÂûã:</label>
                                <select id="pos-encoding-type">
                                    <option value="sinusoidal">Sinusoidal</option>
                                    <option value="rope">RoPE</option>
                                    <option value="both">ÂØπÊØîÊòæÁ§∫</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Â∫èÂàóÈïøÂ∫¶: <span id="rope-seq-len-value">128</span></label>
                                <input type="range" id="rope-seq-len" min="32" max="512" value="128">
                            </div>
                        </div>
                        <div class="plot-container" id="rope-plot"></div>
                    </div>
                    
                    <div class="toggle-content" id="rope-code">
                        <div class="comparison-container">
                            <div class="comparison-item before">
                                <div class="comparison-title">SinusoidalÂÆûÁé∞</div>
                                <div class="code-section">
def sinusoidal_pos_encoding(seq_len, d_model):
    pe = torch.zeros(seq_len, d_model)
    position = torch.arange(0, seq_len).unsqueeze(1).float()
    
    div_term = torch.exp(torch.arange(0, d_model, 2).float() * 
                        -(math.log(10000.0) / d_model))
    
    pe[:, 0::2] = torch.sin(position * div_term)
    pe[:, 1::2] = torch.cos(position * div_term)
    
    return pe
                                </div>
                            </div>
                            <div class="comparison-item after">
                                <div class="comparison-title">RoPEÂÆûÁé∞</div>
                                <div class="code-section">
def apply_rope(q, k, seq_len):
    # ËÆ°ÁÆóÊóãËΩ¨È¢ëÁéá
    dim = q.size(-1)
    inv_freq = 1.0 / (10000 ** (torch.arange(0, dim, 2).float() / dim))
    
    # ÁîüÊàê‰ΩçÁΩÆ
    t = torch.arange(seq_len).float()
    freqs = torch.outer(t, inv_freq)
    
    # ÁîüÊàêÊóãËΩ¨Áü©Èòµ
    cos = freqs.cos()
    sin = freqs.sin()
    
    # Â∫îÁî®ÊóãËΩ¨
    q_rot = rotate_half(q) * sin + q * cos
    k_rot = rotate_half(k) * sin + k * cos
    
    return q_rot, k_rot
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="demo-card">
                    <h3>üìè ÈïøÂ∫èÂàóÂ§ñÊé®ËÉΩÂäõ</h3>
                    <div class="controls">
                        <div class="control-group">
                            <label>ËÆ≠ÁªÉÈïøÂ∫¶: <span id="train-len-value">512</span></label>
                            <input type="range" id="train-len" min="256" max="1024" step="128" value="512">
                        </div>
                        <div class="control-group">
                            <label>ÊµãËØïÈïøÂ∫¶: <span id="test-len-value">1024</span></label>
                            <input type="range" id="test-len" min="512" max="4096" step="256" value="1024">
                        </div>
                    </div>
                    <div class="plot-container" id="extrapolation-plot"></div>
                </div>
            </div>
        </div>
        
        <!-- 2023: Áé∞‰ª£LLM -->
        <div class="demo-section hidden" id="demo-2023">
            <div class="demo-area">
                <div class="demo-card">
                    <h3>üèõÔ∏è Êû∂ÊûÑÂØπÊØîÔºöPost-Norm vs Pre-Norm</h3>
                    
                    <div class="comparison-container">
                        <div class="comparison-item before">
                            <div class="comparison-title">Post-Norm (ÂéüÂßã)</div>
                            <div class="formula-section">
                                <div id="postnorm-arch-formula">
                                    $$\text{Output} = \text{Norm}(x + \text{Sublayer}(x))$$
                                </div>
                            </div>
                        </div>
                        <div class="comparison-item after">
                            <div class="comparison-title">Pre-Norm (Áé∞‰ª£)</div>
                            <div class="formula-section">
                                <div id="prenorm-arch-formula">
                                    $$\text{Output} = x + \text{Sublayer}(\text{Norm}(x))$$
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="toggle-buttons">
                        <button class="toggle-btn active" onclick="toggleContent('arch-viz', this)">ËÆ≠ÁªÉÁ®≥ÂÆöÊÄß</button>
                        <button class="toggle-btn" onclick="toggleContent('arch-code', this)">Êû∂ÊûÑ‰ª£Á†Å</button>
                    </div>
                    
                    <div class="toggle-content active" id="arch-viz">
                        <div class="controls">
                            <div class="control-group">
                                <label>Êû∂ÊûÑÁ±ªÂûã:</label>
                                <select id="norm-position">
                                    <option value="post">Post-Norm (ÂéüÂßã)</option>
                                    <option value="pre">Pre-Norm (Áé∞‰ª£)</option>
                                    <option value="both">ÂØπÊØîÊòæÁ§∫</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>ÁΩëÁªúÂ±ÇÊï∞: <span id="num-layers-value">12</span></label>
                                <input type="range" id="num-layers" min="6" max="24" value="12">
                            </div>
                        </div>
                        <div class="plot-container" id="norm-position-plot"></div>
                    </div>
                    
                    <div class="toggle-content" id="arch-code">
                        <div class="comparison-container">
                            <div class="comparison-item before">
                                <div class="comparison-title">Post-NormÂùó</div>
                                <div class="code-section">
class PostNormBlock(nn.Module):
    def __init__(self, dim):
        super().__init__()
        self.attention = MultiHeadAttention(dim)
        self.ffn = FeedForward(dim)
        self.norm1 = LayerNorm(dim)
        self.norm2 = LayerNorm(dim)
    
    def forward(self, x):
        # Post-Norm: ÂÖàÊìç‰ΩúÂÜçÂΩí‰∏ÄÂåñ
        x = self.norm1(x + self.attention(x))
        x = self.norm2(x + self.ffn(x))
        return x
                                </div>
                            </div>
                            <div class="comparison-item after">
                                <div class="comparison-title">Pre-NormÂùó</div>
                                <div class="code-section">
class PreNormBlock(nn.Module):
    def __init__(self, dim):
        super().__init__()
        self.attention = MultiHeadAttention(dim)
        self.ffn = SwiGLU(dim)
        self.norm1 = RMSNorm(dim)
        self.norm2 = RMSNorm(dim)
    
    def forward(self, x):
        # Pre-Norm: ÂÖàÂΩí‰∏ÄÂåñÂÜçÊìç‰Ωú
        x = x + self.attention(self.norm1(x))
        x = x + self.ffn(self.norm2(x))
        return x
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="demo-card">
                    <h3>üìä ÁªºÂêàÊÄßËÉΩÊèêÂçá</h3>
                    <div class="comparison-grid">
                        <div class="metric-card">
                            <div class="metric-value">40%</div>
                            <div class="metric-label">ËÆ≠ÁªÉÈÄüÂ∫¶ÊèêÂçá</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">25%</div>
                            <div class="metric-label">ËÆ°ÁÆóÊïàÁéáÊèêÂçá</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">8x</div>
                            <div class="metric-label">ÈïøÂ∫èÂàóÂ§ÑÁêÜËÉΩÂäõ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">15%</div>
                            <div class="metric-label">Ê®°ÂûãÊÄßËÉΩÊèêÂçá</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="demo-card architecture-viz">
                <h3>üéâ Áé∞‰ª£LLMÊúÄÁªàÂΩ¢ÊÄÅ</h3>
                <div class="formula-section">
                    <div class="formula-title">Áé∞‰ª£LLMÁöÑÂÆåÊï¥Êû∂ÊûÑÔºö</div>
                    <div id="modern-llm-formula">
                        $$x_{l+1} = x_l + \text{SwiGLU}(\text{RMSNorm}(x_l + \text{RoPE-Attention}(\text{RMSNorm}(x_l))))$$
                    </div>
                </div>
                
                <div class="layer-block">
                    <strong>Pre-Norm + RMSNorm</strong><br>
                    Êõ¥Á®≥ÂÆöÁöÑËÆ≠ÁªÉÔºåÊõ¥Âø´ÁöÑÊî∂Êïõ
                    <div class="improvement-badge">‚úÖ</div>
                </div>
                <div class="layer-block">
                    <strong>RoPE‰ΩçÁΩÆÁºñÁ†Å</strong><br>
                    Áõ∏ÂØπ‰ΩçÁΩÆÁºñÁ†ÅÔºå‰ºòÁßÄÂ§ñÊé®ËÉΩÂäõ
                    <div class="improvement-badge">‚úÖ</div>
                </div>
                <div class="layer-block">
                    <strong>SwiGLUÊøÄÊ¥ª</strong><br>
                    Èó®ÊéßÊú∫Âà∂ÔºåÊõ¥Âº∫Ë°®ËææËÉΩÂäõ
                    <div class="improvement-badge">‚úÖ</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentYear = "2017";
        
        // MathJaxÈÖçÁΩÆ
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
        
        // ÂàáÊç¢ÂÜÖÂÆπÂáΩÊï∞
        function toggleContent(contentId, button) {
            // ÊâæÂà∞Áà∂Á∫ßÂÆπÂô®
            const parent = button.parentElement.parentElement;
            const contents = parent.querySelectorAll('.toggle-content');
            const buttons = parent.querySelectorAll('.toggle-btn');
            
            // ÈöêËóèÊâÄÊúâÂÜÖÂÆπÔºåÁßªÈô§ÊâÄÊúâÊåâÈíÆÊ¥ªË∑ÉÁä∂ÊÄÅ
            contents.forEach(content => content.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÂÜÖÂÆπÔºåÊøÄÊ¥ªÈÄâ‰∏≠ÊåâÈíÆ
            document.getElementById(contentId).classList.add('active');
            button.classList.add('active');
        }
        
        // Êó∂Èó¥Á∫øÂàáÊç¢
        document.querySelectorAll('.timeline-item').forEach(item => {
            item.addEventListener('click', () => {
                // Êõ¥Êñ∞Ê¥ªË∑ÉÁä∂ÊÄÅ
                document.querySelectorAll('.timeline-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                // ÈöêËóèÊâÄÊúâÊºîÁ§∫Âå∫Âüü
                document.querySelectorAll('.demo-section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // ÊòæÁ§∫ÂΩìÂâçÂπ¥‰ªΩÁöÑÊºîÁ§∫
                currentYear = item.dataset.year;
                document.getElementById(`demo-${currentYear}`).classList.remove('hidden');
                
                // ÈáçÊñ∞Ê∏≤ÊüìMathJax
                MathJax.typesetPromise().then(() => {
                    // ÂàùÂßãÂåñÂØπÂ∫îÁöÑÂèØËßÜÂåñ
                    initVisualization(currentYear);
                });
            });
        });
        
        // ÂàùÂßãÂåñÂèØËßÜÂåñ
        function initVisualization(year) {
            switch(year) {
                case "2017":
                    initOriginalTransformer();
                    break;
                case "2019":
                    initRMSNorm();
                    break;
                case "2020":
                    initSwiGLU();
                    break;
                case "2021":
                    initRoPE();
                    break;
                case "2023":
                    initModernLLM();
                    break;
            }
        }
        
        // 2017: ÂéüÂßãTransformer
        function initOriginalTransformer() {
            // ‰ΩçÁΩÆÁºñÁ†ÅÂèØËßÜÂåñ
            function updatePositionalEncoding() {
                const seqLen = parseInt(document.getElementById('seq-len').value);
                const dModel = parseInt(document.getElementById('d-model').value);
                
                document.getElementById('seq-len-value').textContent = seqLen;
                document.getElementById('d-model-value').textContent = dModel;
                
                const positions = Array.from({length: seqLen}, (_, i) => i);
                const dimensions = Array.from({length: Math.min(8, dModel)}, (_, i) => i);
                
                const data = dimensions.map(dim => ({
                    x: positions,
                    y: positions.map(pos => {
                        if (dim % 2 === 0) {
                            return Math.sin(pos / Math.pow(10000, 2 * dim / dModel));
                        } else {
                            return Math.cos(pos / Math.pow(10000, 2 * (dim-1) / dModel));
                        }
                    }),
                    name: `Áª¥Â∫¶ ${dim}`,
                    type: 'scatter',
                    mode: 'lines'
                }));
                
                Plotly.newPlot('pos-encoding-plot', data, {
                    title: 'Ê≠£Âº¶‰ΩçÁΩÆÁºñÁ†ÅÊ®°Âºè',
                    xaxis: { title: '‰ΩçÁΩÆ' },
                    yaxis: { title: 'ÁºñÁ†ÅÂÄº' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            // ÊøÄÊ¥ªÂáΩÊï∞ÂèØËßÜÂåñ
            function updateActivation() {
                const activationType = document.getElementById('activation-type').value;
                const x = Array.from({length: 200}, (_, i) => (i - 100) / 20);
                
                let y, name, color;
                switch(activationType) {
                    case 'relu':
                        y = x.map(val => Math.max(0, val));
                        name = 'ReLU';
                        color = '#ff6b6b';
                        break;
                    case 'gelu':
                        y = x.map(val => val * 0.5 * (1 + Math.tanh(Math.sqrt(2/Math.PI) * (val + 0.044715 * Math.pow(val, 3)))));
                        name = 'GELU';
                        color = '#4ecdc4';
                        break;
                    case 'swish':
                        y = x.map(val => val / (1 + Math.exp(-val)));
                        name = 'Swish';
                        color = '#45b7d1';
                        break;
                    case 'swiglu':
                        y = x.map(val => (val / (1 + Math.exp(-val))) * val);
                        name = 'SwiGLU (ÁÆÄÂåñ)';
                        color = '#96ceb4';
                        break;
                }
                
                const data = [{
                    x: x,
                    y: y,
                    type: 'scatter',
                    mode: 'lines',
                    name: name,
                    line: { color: color, width: 3 }
                }];
                
                Plotly.newPlot('activation-plot', data, {
                    title: `${name} ÊøÄÊ¥ªÂáΩÊï∞`,
                    xaxis: { title: 'ËæìÂÖ•ÂÄº' },
                    yaxis: { title: 'ËæìÂá∫ÂÄº' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            // ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.getElementById('seq-len').addEventListener('input', updatePositionalEncoding);
            document.getElementById('d-model').addEventListener('input', updatePositionalEncoding);
            document.getElementById('activation-type').addEventListener('change', updateActivation);
            
            // ÂàùÂßãÂåñÂõæË°®
            updatePositionalEncoding();
            updateActivation();
        }
        
        // 2019: RMSNorm
        function initRMSNorm() {
            function updateNormComparison() {
                const normType = document.getElementById('norm-type').value;
                const noiseLevel = parseFloat(document.getElementById('noise-level').value);
                
                document.getElementById('noise-level-value').textContent = noiseLevel;
                
                // ÁîüÊàêÂ∏¶Âô™Â£∞ÁöÑËæìÂÖ•Êï∞ÊçÆ
                const x = Array.from({length: 100}, (_, i) => i);
                const cleanSignal = x.map(i => Math.sin(i * 0.1));
                const noisySignal = cleanSignal.map(val => val + (Math.random() - 0.5) * noiseLevel);
                
                let data = [];
                
                if (normType === 'both') {
                    // LayerNormÂ§ÑÁêÜ
                    const mean = noisySignal.reduce((a, b) => a + b) / noisySignal.length;
                    const variance = noisySignal.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / noisySignal.length;
                    const std = Math.sqrt(variance);
                    const layernormSignal = noisySignal.map(val => (val - mean) / (std + 1e-6));
                    
                    // RMSNormÂ§ÑÁêÜ
                    const rms = Math.sqrt(noisySignal.reduce((sum, val) => sum + val * val, 0) / noisySignal.length);
                    const rmsnormSignal = noisySignal.map(val => val / (rms + 1e-6));
                    
                    data = [
                        {
                            x: x,
                            y: noisySignal,
                            name: 'ÂéüÂßã‰ø°Âè∑',
                            type: 'scatter',
                            mode: 'lines',
                            line: { color: '#666', width: 2 }
                        },
                        {
                            x: x,
                            y: layernormSignal,
                            name: 'LayerNorm',
                            type: 'scatter',
                            mode: 'lines',
                            line: { color: '#ff6b6b', width: 2 }
                        },
                        {
                            x: x,
                            y: rmsnormSignal,
                            name: 'RMSNorm',
                            type: 'scatter',
                            mode: 'lines',
                            line: { color: '#4ecdc4', width: 2 }
                        }
                    ];
                } else {
                    // ÂçïÁã¨ÊòæÁ§∫
                    let normalizedSignal;
                    let color, normName;
                    
                    if (normType === 'layernorm') {
                        const mean = noisySignal.reduce((a, b) => a + b) / noisySignal.length;
                        const variance = noisySignal.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / noisySignal.length;
                        const std = Math.sqrt(variance);
                        normalizedSignal = noisySignal.map(val => (val - mean) / (std + 1e-6));
                        color = '#ff6b6b';
                        normName = 'LayerNorm';
                    } else {
                        const rms = Math.sqrt(noisySignal.reduce((sum, val) => sum + val * val, 0) / noisySignal.length);
                        normalizedSignal = noisySignal.map(val => val / (rms + 1e-6));
                        color = '#4ecdc4';
                        normName = 'RMSNorm';
                    }
                    
                    data = [
                        {
                            x: x,
                            y: noisySignal,
                            name: 'ÂéüÂßã‰ø°Âè∑',
                            type: 'scatter',
                            mode: 'lines',
                            line: { color: '#666', width: 2 }
                        },
                        {
                            x: x,
                            y: normalizedSignal,
                            name: `${normName} Â§ÑÁêÜÂêé`,
                            type: 'scatter',
                            mode: 'lines',
                            line: { color: color, width: 2 }
                        }
                    ];
                }
                
                Plotly.newPlot('norm-comparison-plot', data, {
                    title: 'ÂΩí‰∏ÄÂåñÊïàÊûúÂØπÊØî',
                    xaxis: { title: 'Êó∂Èó¥Ê≠•' },
                    yaxis: { title: 'Êï∞ÂÄº' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            document.getElementById('norm-type').addEventListener('change', updateNormComparison);
            document.getElementById('noise-level').addEventListener('input', updateNormComparison);
            
            updateNormComparison();
        }
        
        // 2020: SwiGLU
        function initSwiGLU() {
            function updateActivationEvolution() {
                const comparison = document.getElementById('activation-comparison').value;
                const x = Array.from({length: 200}, (_, i) => (i - 100) / 20);
                
                const activations = {
                    relu: { 
                        y: x.map(val => Math.max(0, val)),
                        color: '#ff6b6b',
                        name: 'ReLU'
                    },
                    gelu: {
                        y: x.map(val => val * 0.5 * (1 + Math.tanh(Math.sqrt(2/Math.PI) * (val + 0.044715 * Math.pow(val, 3))))),
                        color: '#4ecdc4',
                        name: 'GELU'
                    },
                    swish: {
                        y: x.map(val => val / (1 + Math.exp(-val))),
                        color: '#45b7d1',
                        name: 'Swish'
                    },
                    swiglu: {
                        y: x.map(val => (val / (1 + Math.exp(-val))) * val),
                        color: '#96ceb4',
                        name: 'SwiGLU'
                    }
                };
                
                let data = [];
                if (comparison === 'all') {
                    data = Object.values(activations).map(act => ({
                        x: x,
                        y: act.y,
                        type: 'scatter',
                        mode: 'lines',
                        name: act.name,
                        line: { color: act.color, width: 3 }
                    }));
                } else {
                    const [first, second] = comparison.split('-');
                    data = [activations[first], activations[second]].map(act => ({
                        x: x,
                        y: act.y,
                        type: 'scatter',
                        mode: 'lines',
                        name: act.name,
                        line: { color: act.color, width: 3 }
                    }));
                }
                
                Plotly.newPlot('activation-evolution-plot', data, {
                    title: 'ÊøÄÊ¥ªÂáΩÊï∞ÊºîËøõÂØπÊØî',
                    xaxis: { title: 'ËæìÂÖ•ÂÄº' },
                    yaxis: { title: 'ËæìÂá∫ÂÄº' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            function updateGradientFlow() {
                const depth = parseInt(document.getElementById('depth').value);
                document.getElementById('depth-value').textContent = depth;
                
                const layers = Array.from({length: depth}, (_, i) => i + 1);
                
                // Ê®°Êãü‰∏çÂêåÊøÄÊ¥ªÂáΩÊï∞ÁöÑÊ¢ØÂ∫¶ÊµÅ
                const gradientFlows = {
                    relu: layers.map(layer => Math.pow(0.8, layer - 1)),
                    gelu: layers.map(layer => Math.pow(0.85, layer - 1)),
                    swish: layers.map(layer => Math.pow(0.9, layer - 1)),
                    swiglu: layers.map(layer => Math.pow(0.95, layer - 1))
                };
                
                const data = Object.entries(gradientFlows).map(([name, flow]) => ({
                    x: layers,
                    y: flow,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: name.toUpperCase(),
                    line: { width: 3 }
                }));
                
                Plotly.newPlot('gradient-flow-plot', data, {
                    title: 'Ê¢ØÂ∫¶ÊµÅË°∞ÂáèÂØπÊØî',
                    xaxis: { title: 'ÁΩëÁªúÂ±ÇÊï∞' },
                    yaxis: { title: 'Ê¢ØÂ∫¶Âº∫Â∫¶', type: 'log' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            document.getElementById('activation-comparison').addEventListener('change', updateActivationEvolution);
            document.getElementById('depth').addEventListener('input', updateGradientFlow);
            
            updateActivationEvolution();
            updateGradientFlow();
        }
        
        // 2021: RoPE
        function initRoPE() {
            function updateRoPE() {
                const posEncodingType = document.getElementById('pos-encoding-type').value;
                const seqLen = parseInt(document.getElementById('rope-seq-len').value);
                
                document.getElementById('rope-seq-len-value').textContent = seqLen;
                
                const positions = Array.from({length: seqLen}, (_, i) => i);
                
                if (posEncodingType === 'both') {
                    // ÁîüÊàêSinusoidalÁõ∏ÂÖ≥ÊÄßÁü©Èòµ
                    const sinCorrelation = positions.map(i => 
                        positions.map(j => Math.cos((i - j) * Math.PI / 64))
                    );
                    
                    // ÁîüÊàêRoPEÁõ∏ÂÖ≥ÊÄßÁü©Èòµ (Êõ¥Â•ΩÁöÑÁõ∏ÂØπ‰ΩçÁΩÆÂª∫Ê®°)
                    const ropeCorrelation = positions.map(i => 
                        positions.map(j => Math.cos(Math.abs(i - j) * Math.PI / 128) * Math.exp(-Math.abs(i - j) / 100))
                    );
                    
                    const data = [
                        {
                            z: sinCorrelation,
                            x: positions,
                            y: positions,
                            type: 'heatmap',
                            colorscale: 'Viridis',
                            name: 'Sinusoidal',
                            visible: true,
                            showscale: false
                        },
                        {
                            z: ropeCorrelation,
                            x: positions,
                            y: positions,
                            type: 'heatmap',
                            colorscale: 'Plasma',
                            name: 'RoPE',
                            visible: false,
                            showscale: false
                        }
                    ];
                    
                    const layout = {
                        title: 'Sinusoidal vs RoPE ‰ΩçÁΩÆÁõ∏ÂÖ≥ÊÄßÂØπÊØî',
                        xaxis: { title: '‰ΩçÁΩÆi' },
                        yaxis: { title: '‰ΩçÁΩÆj' },
                        margin: { t: 60, r: 60, b: 40, l: 40 },
                        updatemenus: [{
                            type: 'buttons',
                            direction: 'left',
                            buttons: [{
                                args: [{'visible': [true, false]}],
                                label: 'Sinusoidal',
                                method: 'restyle'
                            }, {
                                args: [{'visible': [false, true]}],
                                label: 'RoPE',
                                method: 'restyle'
                            }],
                            x: 0.1,
                            y: 1.02,
                            xanchor: 'left',
                            yanchor: 'top'
                        }]
                    };
                    
                    Plotly.newPlot('rope-plot', data, layout);
                } else {
                    // ÂçïÁã¨ÊòæÁ§∫
                    let correlation, title, colorscale;
                    
                    if (posEncodingType === 'sinusoidal') {
                        correlation = positions.map(i => 
                            positions.map(j => Math.cos((i - j) * Math.PI / 64))
                        );
                        title = 'Sinusoidal ‰ΩçÁΩÆÁõ∏ÂÖ≥ÊÄßÁü©Èòµ';
                        colorscale = 'Viridis';
                    } else {
                        correlation = positions.map(i => 
                            positions.map(j => Math.cos(Math.abs(i - j) * Math.PI / 128) * Math.exp(-Math.abs(i - j) / 100))
                        );
                        title = 'RoPE ‰ΩçÁΩÆÁõ∏ÂÖ≥ÊÄßÁü©Èòµ';
                        colorscale = 'Plasma';
                    }
                    
                    const data = [{
                        z: correlation,
                        x: positions,
                        y: positions,
                        type: 'heatmap',
                        colorscale: colorscale
                    }];
                    
                    Plotly.newPlot('rope-plot', data, {
                        title: title,
                        xaxis: { title: '‰ΩçÁΩÆi' },
                        yaxis: { title: '‰ΩçÁΩÆj' },
                        margin: { t: 40, r: 60, b: 40, l: 40 }
                    });
                }
            }
            
            function updateExtrapolation() {
                const trainLen = parseInt(document.getElementById('train-len').value);
                const testLen = parseInt(document.getElementById('test-len').value);
                
                document.getElementById('train-len-value').textContent = trainLen;
                document.getElementById('test-len-value').textContent = testLen;
                
                const positions = Array.from({length: testLen}, (_, i) => i);
                
                // Ê®°ÊãüÊÄßËÉΩË°∞Âáè
                const sinusoidalPerf = positions.map(pos => {
                    if (pos <= trainLen) return 1.0;
                    return Math.max(0.3, 1.0 - (pos - trainLen) / trainLen * 0.8);
                });
                
                const ropePerf = positions.map(pos => {
                    if (pos <= trainLen) return 1.0;
                    return Math.max(0.7, 1.0 - (pos - trainLen) / trainLen * 0.3);
                });
                
                const data = [
                    {
                        x: positions,
                        y: sinusoidalPerf,
                        name: 'Sinusoidal ‰ΩçÁΩÆÁºñÁ†Å',
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#ff6b6b', width: 3 }
                    },
                    {
                        x: positions,
                        y: ropePerf,
                        name: 'RoPE',
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#4ecdc4', width: 3 }
                    },
                    {
                        x: [trainLen, trainLen],
                        y: [0, 1],
                        name: 'ËÆ≠ÁªÉÈïøÂ∫¶ËæπÁïå',
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#666', dash: 'dash' }
                    }
                ];
                
                Plotly.newPlot('extrapolation-plot', data, {
                    title: 'ÈïøÂ∫èÂàóÂ§ñÊé®ËÉΩÂäõÂØπÊØî',
                    xaxis: { title: 'Â∫èÂàóÈïøÂ∫¶' },
                    yaxis: { title: 'ÊÄßËÉΩ‰øùÊåÅÁéá' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            document.getElementById('pos-encoding-type').addEventListener('change', updateRoPE);
            document.getElementById('rope-seq-len').addEventListener('input', updateRoPE);
            document.getElementById('train-len').addEventListener('input', updateExtrapolation);
            document.getElementById('test-len').addEventListener('input', updateExtrapolation);
            
            updateRoPE();
            updateExtrapolation();
        }
        
        // 2023: Áé∞‰ª£LLM
        function initModernLLM() {
            function updateNormPosition() {
                const normPosition = document.getElementById('norm-position').value;
                const numLayers = parseInt(document.getElementById('num-layers').value);
                
                document.getElementById('num-layers-value').textContent = numLayers;
                
                const epochs = Array.from({length: 100}, (_, i) => i + 1);
                
                // Ê®°ÊãüËÆ≠ÁªÉÁ®≥ÂÆöÊÄß - Âä†ÂÖ•Â±ÇÊï∞ÂΩ±Âìç
                const layerFactor = Math.log(numLayers) / Math.log(12); // ‰ª•12Â±Ç‰∏∫Âü∫ÂáÜ
                
                const postNormLoss = epochs.map(epoch => {
                    const base = 2.0 * Math.exp(-epoch / (30 + layerFactor * 10));
                    const noise = Math.sin(epoch * 0.3) * 0.2 * Math.exp(-epoch / 20) * (1 + layerFactor * 0.5);
                    return Math.max(0.1, base + noise);
                });
                
                const preNormLoss = epochs.map(epoch => {
                    const base = 2.0 * Math.exp(-epoch / (20 - layerFactor * 2));
                    const noise = Math.sin(epoch * 0.1) * 0.1 * Math.exp(-epoch / 30) * (1 + layerFactor * 0.2);
                    return Math.max(0.05, base + noise);
                });
                
                let data = [];
                
                if (normPosition === 'both') {
                    data = [
                        {
                            x: epochs,
                            y: postNormLoss,
                            name: 'Post-Norm',
                            type: 'scatter',
                            mode: 'lines',
                            line: { color: '#ff6b6b', width: 3 }
                        },
                        {
                            x: epochs,
                            y: preNormLoss,
                            name: 'Pre-Norm',
                            type: 'scatter',
                            mode: 'lines',
                            line: { color: '#4ecdc4', width: 3 }
                        }
                    ];
                } else {
                    const isPostNorm = normPosition === 'post';
                    data = [{
                        x: epochs,
                        y: isPostNorm ? postNormLoss : preNormLoss,
                        name: isPostNorm ? 'Post-Norm' : 'Pre-Norm',
                        type: 'scatter',
                        mode: 'lines',
                        line: { 
                            color: isPostNorm ? '#ff6b6b' : '#4ecdc4',
                            width: 3 
                        }
                    }];
                }
                
                Plotly.newPlot('norm-position-plot', data, {
                    title: `ËÆ≠ÁªÉÁ®≥ÂÆöÊÄßÂØπÊØî (${numLayers}Â±ÇÁΩëÁªú)`,
                    xaxis: { title: 'ËÆ≠ÁªÉËΩÆÊ¨°' },
                    yaxis: { title: 'ÊçüÂ§±ÂÄº', type: 'log' },
                    margin: { t: 40, r: 20, b: 40, l: 40 }
                });
            }
            
            document.getElementById('norm-position').addEventListener('change', updateNormPosition);
            document.getElementById('num-layers').addEventListener('input', updateNormPosition);
            
            updateNormPosition();
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            // Ê∏≤ÊüìMathJax
            MathJax.typesetPromise().then(() => {
                initVisualization(currentYear);
            });
        });
    </script>
</body>
</html>
