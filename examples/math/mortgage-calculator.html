<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á≠âÈ¢ùÊú¨ÊÅØËøòÊ¨æËÆ°ÁÆóÂô® - Êï∞Â≠¶ÂàÜÊûê</title>
    
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <!-- KaTeX JS -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding: 24px;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            padding: 32px;
            margin-bottom: 24px;
        }
        
        .header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .header-icon {
            font-size: 32px;
        }
        
        h1 {
            font-size: 30px;
            font-weight: bold;
            color: #1f2937;
        }
        
        h2 {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 16px;
        }
        
        h3 {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        .formula-section {
            background: #eef2ff;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .formula-title {
            font-size: 20px;
            font-weight: 600;
            color: #312e81;
            margin-bottom: 16px;
        }
        
        .formula-box {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #6366f1;
            margin-bottom: 16px;
        }
        
        .formula-content {
            background: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin: 8px 0;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }
        
        input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .stat-card {
            border-radius: 8px;
            padding: 16px;
            color: white;
        }
        
        .stat-card-blue { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .stat-card-green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .stat-card-orange { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
        .stat-card-purple { background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        .stat-extra {
            font-size: 12px;
            opacity: 0.75;
            margin-top: 4px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        thead {
            background: #f3f4f6;
        }
        
        th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
        }
        
        th:not(:first-child) {
            text-align: right;
        }
        
        td {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        td:not(:first-child) {
            text-align: right;
        }
        
        tbody tr:hover {
            background: #f9fafb;
        }
        
        .info-box {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .info-box-blue {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }
        
        .info-box-amber {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
        }
        
        .info-box-red {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
        }
        
        .info-box-green {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
        }
        
        .info-box-purple {
            background: #faf5ff;
            border-left: 4px solid #a855f7;
        }
        
        .border-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 2px solid;
        }
        
        .border-blue { border-color: #93c5fd; }
        .border-green { border-color: #86efac; }
        .border-purple { border-color: #d8b4fe; }
        
        .comparison-card {
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .comparison-green {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #10b981;
        }
        
        .comparison-yellow {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-color: #f59e0b;
        }
        
        .comparison-red {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #ef4444;
        }
        
        .chart-container {
            position: relative;
            height: 450px;
            margin-bottom: 24px;
        }
        
        .chart-container-small {
            position: relative;
            height: 350px;
            margin-bottom: 24px;
        }
        
        .chart-container-medium {
            position: relative;
            height: 400px;
            margin-bottom: 24px;
        }
        
        ul {
            list-style: none;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        .text-sm { font-size: 14px; }
        .text-xs { font-size: 12px; }
        .text-gray-700 { color: #374151; }
        .text-gray-600 { color: #4b5563; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .font-mono { font-family: 'Courier New', monospace; }
        
        @media (max-width: 768px) {
            body { padding: 12px; }
            .card { padding: 16px; }
            h1 { font-size: 24px; }
            h2 { font-size: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <div class="header-icon">üßÆ</div>
                <h1>Á≠âÈ¢ùÊú¨ÊÅØËøòÊ¨æËÆ°ÁÆóÂô®</h1>
            </div>
            
            <div class="formula-section">
                <div class="formula-title">Êï∞Â≠¶Ê®°ÂûãÔºàÁ¶ªÊï£ÂáΩÊï∞Ôºâ</div>
                <div id="formulas"></div>
            </div>
            
            <div class="grid-3">
                <div class="input-group">
                    <label>Ë¥∑Ê¨æÊú¨ÈáëÔºàÂÖÉÔºâ</label>
                    <input type="number" id="principal" value="1000000">
                </div>
                <div class="input-group">
                    <label>Âπ¥Âà©ÁéáÔºà%Ôºâ</label>
                    <input type="number" step="0.01" id="annualRate" value="5.0">
                </div>
                <div class="input-group">
                    <label>Ë¥∑Ê¨æÊúàÊï∞</label>
                    <input type="number" id="months" value="360">
                </div>
            </div>
            
            <div class="grid-4">
                <div class="stat-card stat-card-blue">
                    <div class="stat-label">ÊØèÊúàËøòÊ¨æÈ¢ù</div>
                    <div class="stat-value" id="monthlyPayment">¬•0.00</div>
                </div>
                <div class="stat-card stat-card-green">
                    <div class="stat-label">ÊÄªËøòÊ¨æÈ¢ù</div>
                    <div class="stat-value" id="totalPayment">¬•0.00</div>
                </div>
                <div class="stat-card stat-card-orange">
                    <div class="stat-label">ÊÄªÂà©ÊÅØ</div>
                    <div class="stat-value" id="totalInterest">¬•0.00</div>
                </div>
                <div class="stat-card stat-card-purple">
                    <div class="stat-label">ÊúÄÂêé‰∏ÄÊúüËøòÊ¨æ</div>
                    <div class="stat-value" id="lastPayment">¬•0.00</div>
                    <div class="stat-extra" id="lastPaymentDiff">Â∑ÆÂºÇ: ¬•0.00</div>
                </div>
            </div>
            
            <div>
                <h3>ËøòÊ¨æÊòéÁªÜÔºàÂâç12ÊúüÔºâ</h3>
                <div style="overflow-x: auto;">
                    <table id="scheduleTable"></table>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Á¶ªÊï£ÂáΩÊï∞ vs ËøûÁª≠Ëøë‰ºº</h2>
            <div class="info-box info-box-blue">
                <p class="text-sm font-semibold" style="margin-bottom: 8px;" id="chartDescription"></p>
                <div class="text-xs text-gray-600">
                    <p>‚Ä¢ Ê©ôËâ≤ÂÆûÁ∫øÔºöÁ¶ªÊï£ÂÖ¨ÂºèÔºàËôΩÁÑ∂Êï∞Â≠¶‰∏äÂèØÂØπÂÆûÊï∞nÊ±ÇÂÄºÔºå‰ΩÜÂÆûÈôÖÂè™Âú®Êï¥Êï∞ÁÇπÊúâÊÑè‰πâÔºâ</p>
                    <p>‚Ä¢ ËìùËâ≤ËôöÁ∫øÔºöÊåáÊï∞Ëøë‰ºº (1+Œ±)^n ‚âà e^(Œ±n)</p>
                    <p>‚Ä¢ ÁªøËâ≤ÁÇπÁ∫øÔºöËøûÁª≠ËøòÊ¨æÊ®°Âûã</p>
                    <p>‚Ä¢ Ê©ôËâ≤Êï£ÁÇπÔºöÂÆûÈôÖÂ∫îÁî®‰∏≠ÁöÑÁ¶ªÊï£ÁÇπÔºàÊï¥Êï∞ÊúàÔºâ</p>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="comparisonChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h2>ÊåáÊï∞Ëøë‰ººÁöÑÁõ∏ÂØπËØØÂ∑Æ</h2>
            <div class="info-box info-box-amber">
                <p class="text-sm">Áõ∏ÂØπËØØÂ∑Æ = (Á¶ªÊï£ÂÖ¨Âºè - ÊåáÊï∞Ëøë‰ºº) / Á¶ªÊï£ÂÖ¨Âºè √ó 100%</p>
                <p class="text-xs text-gray-600" style="margin-top: 8px;">
                    ËØØÂ∑ÆÈùûÂ∏∏Â∞èÔºàÂ∞è‰∫é 0.3%ÔºâÔºåËØ¥ÊòéÊåáÊï∞Ëøë‰ºº e^(Œ±n) ÈùûÂ∏∏ÂáÜÁ°ÆÔºåËøôËØÅÊòé‰∫ÜÁ≠âÈ¢ùÊú¨ÊÅØÂÖ¨Âºè‰∏éËá™ÁÑ∂ÂØπÊï∞Â∫ï e ÁöÑÊ∑±ÂàªËÅîÁ≥ª„ÄÇ
                </p>
            </div>
            <div class="chart-container-small">
                <canvas id="errorChart"></canvas>
            </div>
            
            <div style="margin-top: 24px;">
                <h3>ÂÖ≥ÈîÆÊúüÊï∞ÁöÑÊï∞ÂÄºÂØπÊØî</h3>
                <div style="overflow-x: auto;">
                    <table id="comparisonTable"></table>
                </div>
            </div>
            
            <div class="info-box info-box-green" style="margin-top: 24px;">
                <p class="text-sm font-semibold" style="margin-bottom: 8px;">‚úÖ ÁªìËÆ∫</p>
                <ul class="text-sm text-gray-700">
                    <li>‚Ä¢ Á≠âÈ¢ùÊú¨ÊÅØÂÖ¨ÂºèËôΩÁÑ∂Âú®ÂÆûÈôÖ‰∏≠ÊòØ<strong>Á¶ªÊï£ÁöÑ</strong>ÔºàÊï¥Êï∞ÊúàÔºâÔºå‰ΩÜÊï∞Â≠¶‰∏äÊòØÂÖ≥‰∫éÂÆûÊï∞ n ÁöÑ<strong>ËøûÁª≠ÂáΩÊï∞</strong></li>
                    <li>‚Ä¢ ÂΩì Œ± ËæÉÂ∞èÊó∂Ôºå(1+Œ±)^n ‚âà e^(Œ±n) ÁöÑËøë‰ººÈùûÂ∏∏Á≤æÁ°ÆÔºàËØØÂ∑ÆÂ∞è‰∫é 0.3%Ôºâ</li>
                    <li>‚Ä¢ ËøôËØ¥ÊòéÊåâÊè≠Ë¥∑Ê¨æÂÖ¨Âºè‰∏éËá™ÁÑ∂ÂØπÊï∞Â∫ï e Êúâ<strong>Ê∑±ÂàªÁöÑÂÜÖÂú®ËÅîÁ≥ª</strong></li>
                    <li>‚Ä¢ ËøûÁª≠ËøòÊ¨æÊ®°Âûã‰∏éÊåáÊï∞Ëøë‰ººÂú®Êï∞ÂÄº‰∏äÂá†‰πé‰∏ÄËá¥ÔºåËØÅÊòé‰∫ÜÁ¶ªÊï£Â§çÂà©‰∏éËøûÁª≠Â§çÂà©ÁöÑÁ≠â‰ª∑ÊÄß</li>
                </ul>
            </div>
        </div>
        
        <div class="card">
            <h2>ËæπÈôÖÊïàÁõäÈÄíÂáèÂàÜÊûêÔºö‰∏∫‰ΩïÈïøÊúüË¥∑Ê¨æÊàê‰∏∫"Ê∞∏Áª≠ÂÄ∫"</h2>
            <div class="info-box info-box-red">
                <p class="font-semibold text-sm" style="margin-bottom: 8px;">Ê†∏ÂøÉÊ¥ûÂØü</p>
                <p class="text-sm text-gray-700">
                    ‰ªéÂáΩÊï∞Êõ≤Á∫øÂèØ‰ª•ÁúãÂá∫ÔºåÈöèÁùÄË¥∑Ê¨æÊúüÈôêÂ¢ûÂä†Ôºå<strong>ÊØèÂ¢ûÂä†‰∏ÄÂπ¥ÊúüÈôêÔºåÊúà‰æõÂáèÂ∞ëÁöÑÂπÖÂ∫¶Ë∂äÊù•Ë∂äÂ∞è</strong>„ÄÇ
                    ËøôÊÑèÂë≥ÁùÄÔºöÂª∂ÈïøË¥∑Ê¨æÊúüÈôêÁöÑËæπÈôÖÊî∂ÁõäÈÄíÂáèÔºåË∂ÖËøá30Âπ¥ÂêéÂá†‰πéÊ≤°ÊúâÂÆûÈôÖÊÑè‰πâÔºåÂèçËÄå‰ΩøË¥∑Ê¨æÊàê‰∏∫"Ê∞∏Áª≠ÂÄ∫"„ÄÇ
                </p>
            </div>
            
            <div class="grid-2">
                <div class="info-box info-box-blue">
                    <h3 style="color: #1e40af;">ÂèòÂåñÁéáÂØπÊØîÔºàÂçï‰ΩçÊú¨Èáë P=1Ôºâ</h3>
                    <div id="derivativeStats"></div>
                </div>
                
                <div class="info-box info-box-amber">
                    <h3 style="color: #92400e;">ÂÆûÈôÖÂê´‰πâËß£ËØª</h3>
                    <ul class="text-sm text-gray-700">
                        <li style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <span style="color: #059669; font-weight: bold;">‚úì</span>
                            <span><strong>5-15Âπ¥Ôºö</strong>ÊØèÂ¢ûÂä†1Âπ¥ÊúüÈôêÔºåÊúà‰æõÊòæËëóÈôç‰ΩéÔºåÂÄºÂæóËÄÉËôë</span>
                        </li>
                        <li style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <span style="color: #d97706; font-weight: bold;">‚ñ≤</span>
                            <span><strong>15-30Âπ¥Ôºö</strong>Êúà‰æõÁªßÁª≠Èôç‰ΩéÔºå‰ΩÜÂπÖÂ∫¶ÂºÄÂßãÂáèÁºì</span>
                        </li>
                        <li style="display: flex; gap: 8px;">
                            <span style="color: #dc2626; font-weight: bold;">‚úó</span>
                            <span><strong>30Âπ¥‰ª•‰∏äÔºö</strong>Êúà‰æõÂá†‰πé‰∏çÂÜçÈôç‰ΩéÔºå‰ΩÜÊÄªÂà©ÊÅØÊåÅÁª≠ÊøÄÂ¢ûÔºåÊàê‰∏∫"Ê∞∏Áª≠ÂÄ∫"</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="chart-container-medium">
                <canvas id="derivativeChart"></canvas>
            </div>
            
            <div class="grid-3" style="margin-top: 24px;">
                <div class="comparison-card comparison-green" id="comparison1020"></div>
                <div class="comparison-card comparison-yellow" id="comparison2030"></div>
                <div class="comparison-card comparison-red" id="comparison3040"></div>
            </div>
            
            <div class="info-box info-box-purple" style="margin-top: 24px;" id="mathExplanation"></div>
        </div>
    </div>

    <script>
        // ËÆ°ÁÆóÂáΩÊï∞
        function calculateDiscretePayment(P, yearRate, n) {
            const alpha = yearRate / 100 / 12;
            if (alpha === 0) return P / n;
            if (n === 0) return Infinity;
            return P * alpha * Math.pow(1 + alpha, n) / (Math.pow(1 + alpha, n) - 1);
        }

        function calculateExponentialApprox(P, yearRate, n) {
            const alpha = yearRate / 100 / 12;
            if (alpha === 0) return P / n;
            if (n === 0) return Infinity;
            return P * alpha * Math.exp(alpha * n) / (Math.exp(alpha * n) - 1);
        }

        function calculateContinuousPayment(P, yearRate, n) {
            const alpha = yearRate / 100 / 12;
            if (alpha === 0) return P / n;
            if (n === 0) return Infinity;
            return P * alpha / (1 - Math.exp(-alpha * n));
        }

        // Ê∏≤ÊüìLaTeX
        function renderLatex(element, latex, displayMode = false) {
            if (window.katex) {
                katex.render(latex, element, { throwOnError: false, displayMode });
            } else {
                element.textContent = latex;
            }
        }

        // ÂÖ®Â±ÄÂèòÈáè
        let comparisonChart, errorChart, derivativeChart;

        // ÂàùÂßãÂåñ
        function init() {
            renderFormulas();
            calculate();
            
            // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨
            document.getElementById('principal').addEventListener('input', calculate);
            document.getElementById('annualRate').addEventListener('input', calculate);
            document.getElementById('months').addEventListener('input', calculate);
        }

        function renderFormulas() {
            const container = document.getElementById('formulas');
            container.innerHTML = `
                <div class="formula-box">
                    <p class="text-sm text-gray-600" style="margin-bottom: 8px;">Á≠âÈ¢ùÊú¨ÊÅØÊúà‰æõÂÖ¨ÂºèÔºàÁ¶ªÊï£ÔºâÔºö</p>
                    <div class="formula-content" id="mainFormula"></div>
                    <div class="text-sm text-gray-600" style="margin-top: 12px;">
                        <p>ÂÖ∂‰∏≠Ôºö<span id="vars"></span></p>
                        <p style="color: #1d4ed8; font-weight: 500; margin-top: 8px;">
                            Ê≥®ÊÑèÔºöËôΩÁÑ∂Êï∞Â≠¶‰∏äËØ•ÂºèÂØπÂÆûÊï∞nÊúâÂÆö‰πâÔºå‰ΩÜÂÆûÈôÖÂ∫îÁî®‰∏≠nÂøÖÈ°ª‰∏∫Ê≠£Êï¥Êï∞ÔºàÊúàÊï∞Ôºâ
                        </p>
                    </div>
                </div>
                <div class="grid-3">
                    <div class="border-card border-blue">
                        <p class="font-semibold" style="color: #1e40af; margin-bottom: 8px;">ÊåáÊï∞Ëøë‰ººÔºö</p>
                        <div class="text-sm" style="text-align: center;">
                            <div id="expApprox"></div>
                            <p class="text-gray-600" style="margin-top: 8px;">ÂΩìŒ±ËæÉÂ∞èÊó∂</p>
                        </div>
                    </div>
                    <div class="border-card border-green">
                        <p class="font-semibold" style="color: #047857; margin-bottom: 8px;">ËøûÁª≠ËøòÊ¨æÊ®°ÂûãÔºö</p>
                        <div class="text-sm" style="text-align: center;">
                            <div id="contModel"></div>
                            <p class="text-gray-600" style="margin-top: 8px;">ÁêÜÊÉ≥ÂåñËøûÁª≠ÂÅøËøò</p>
                        </div>
                    </div>
                    <div class="border-card border-purple">
                        <p class="font-semibold" style="color: #7c3aed; margin-bottom: 8px;">Ê∏êËøëÁ∫øÔºö</p>
                        <div class="text-sm" style="text-align: center;">
                            <div id="asymptote"></div>
                            <p class="text-gray-600" style="margin-top: 8px;">Ê∞∏Áª≠Âπ¥ÈáëÔºàÂè™ËøòÂà©ÊÅØÔºâ</p>
                        </div>
                    </div>
                </div>
            `;
            
            renderLatex(document.getElementById('mainFormula'), 'M = P \\cdot \\frac{\\alpha (1+\\alpha)^n}{(1+\\alpha)^n - 1}', true);
            
            const varsSpan = document.createElement('span');
            renderLatex(varsSpan, 'P');
            const varsText = ' = Êú¨ÈáëÔºå';
            const alphaSpan = document.createElement('span');
            renderLatex(alphaSpan, '\\alpha = r/12');
            const varsText2 = ' = ÊúàÂà©ÁéáÔºå';
            const nSpan = document.createElement('span');
            renderLatex(nSpan, 'n');
            const varsText3 = ' = ËøòÊ¨æÊúàÊï∞ÔºàÊï¥Êï∞Ôºâ';
            
            const varsContainer = document.getElementById('vars');
            varsContainer.appendChild(varsSpan);
            varsContainer.appendChild(document.createTextNode(varsText));
            varsContainer.appendChild(alphaSpan);
            varsContainer.appendChild(document.createTextNode(varsText2));
            varsContainer.appendChild(nSpan);
            varsContainer.appendChild(document.createTextNode(varsText3));
            
            renderLatex(document.getElementById('expApprox'), '(1+\\alpha)^n \\approx e^{\\alpha n}', true);
            renderLatex(document.getElementById('contModel'), 'M_c = P \\cdot \\frac{\\alpha}{1 - e^{-\\alpha n}}', true);
            renderLatex(document.getElementById('asymptote'), '\\lim_{n \\to \\infty} M = P \\cdot \\alpha', true);
        }

        function calculate() {
            const principal = Number(document.getElementById('principal').value);
            const annualRate = Number(document.getElementById('annualRate').value);
            const months = Number(document.getElementById('months').value);
            const alpha = annualRate / 100 / 12;
            
            // ËÆ°ÁÆóËøòÊ¨æÊï∞ÊçÆ
            const monthlyPayment = calculateDiscretePayment(principal, annualRate, months);
            const totalPayment = monthlyPayment * months;
            const totalInterest = totalPayment - principal;
            
            // ËÆ°ÁÆóÊúÄÂêé‰∏ÄÊúü
            const lastPeriodPrincipal = principal * Math.pow(1 + alpha, months - 1) - 
                monthlyPayment * (Math.pow(1 + alpha, months - 1) - 1) / alpha;
            const lastPayment = lastPeriodPrincipal * (1 + alpha);
            
            // Êõ¥Êñ∞ÁªüËÆ°Âç°Áâá
            document.getElementById('monthlyPayment').textContent = '¬•' + monthlyPayment.toFixed(2);
            document.getElementById('totalPayment').textContent = '¬•' + totalPayment.toFixed(2);
            document.getElementById('totalInterest').textContent = '¬•' + totalInterest.toFixed(2);
            document.getElementById('lastPayment').textContent = '¬•' + lastPayment.toFixed(2);
            document.getElementById('lastPaymentDiff').textContent = 'Â∑ÆÂºÇ: ¬•' + (lastPayment - monthlyPayment).toFixed(2);
            
            // ÁîüÊàêËøòÊ¨æÊòéÁªÜË°®
            generateScheduleTable(principal, annualRate, months);
            
            // Êõ¥Êñ∞ÂõæË°®ÊèèËø∞
            document.getElementById('chartDescription').textContent = 
                `ÂõæË°®ËØ¥ÊòéÔºöÊú¨ÈáëÊ†áÂáÜÂåñ‰∏∫ P=1ÔºåÂπ¥Âà©Áéá r=${annualRate}%ÔºàÊúàÂà©Áéá Œ±=${alpha.toFixed(6)}Ôºâ`;
            
            // ÁîüÊàêÂõæË°®
            generateComparisonChart(annualRate, alpha);
            generateErrorChart(annualRate);
            generateComparisonTable(annualRate);
            generateDerivativeChart(annualRate);
            generateComparisonCards(principal, annualRate);
            generateMathExplanation(alpha);
        }

        function generateScheduleTable(principal, annualRate, months) {
            const alpha = annualRate / 100 / 12;
            const M = calculateDiscretePayment(principal, annualRate, months);
            let remainingPrincipal = principal;
            
            let html = '<thead><tr><th>ÊúüÊï∞</th><th>ËøòÊ¨æÈ¢ù</th><th>Êú¨Èáë</th><th>Âà©ÊÅØ</th><th>Ââ©‰ΩôÊú¨Èáë</th></tr></thead><tbody>';
            
            for (let i = 1; i <= Math.min(12, months); i++) {
                const interestPayment = remainingPrincipal * alpha;
                let principalPayment = M - interestPayment;
                
                if (i === months) {
                    principalPayment = remainingPrincipal;
                    const actualPayment = principalPayment + interestPayment;
                    html += `<tr>
                        <td>${i}</td>
                        <td>¬•${actualPayment.toFixed(2)}</td>
                        <td>¬•${principalPayment.toFixed(2)}</td>
                        <td>¬•${interestPayment.toFixed(2)}</td>
                        <td>¬•0.00</td>
                    </tr>`;
                } else {
                    remainingPrincipal -= principalPayment;
                    html += `<tr>
                        <td>${i}</td>
                        <td>¬•${M.toFixed(2)}</td>
                        <td>¬•${principalPayment.toFixed(2)}</td>
                        <td>¬•${interestPayment.toFixed(2)}</td>
                        <td>¬•${remainingPrincipal.toFixed(2)}</td>
                    </tr>`;
                }
            }
            
            html += '</tbody>';
            document.getElementById('scheduleTable').innerHTML = html;
        }

        function generateComparisonChart(annualRate, alpha) {
            const data = [];
            const labels = [];
            const discreteData = [];
            const exponentialData = [];
            const continuousData = [];
            const scatterData = [];
            
            for (let n = 0.5; n <= 400; n += 0.5) {
                labels.push(n);
                discreteData.push(calculateDiscretePayment(1, annualRate, n));
                exponentialData.push(calculateExponentialApprox(1, annualRate, n));
                continuousData.push(calculateContinuousPayment(1, annualRate, n));
            }
            
            for (let n = 1; n <= 400; n += 6) {
                scatterData.push({ x: n, y: calculateDiscretePayment(1, annualRate, n) });
            }
            
            const ctx = document.getElementById('comparisonChart');
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }
            
            comparisonChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Á¶ªÊï£ÂÖ¨ÂºèÔºàÂÆûÊï∞nÔºâ',
                            data: discreteData,
                            borderColor: '#f97316',
                            borderWidth: 2.5,
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'ÊåáÊï∞Ëøë‰ºº e^(Œ±n)',
                            data: exponentialData,
                            borderColor: '#3b82f6',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'ËøûÁª≠ËøòÊ¨æÊ®°Âûã',
                            data: continuousData,
                            borderColor: '#10b981',
                            borderWidth: 1.5,
                            borderDash: [3, 3],
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            type: 'scatter',
                            label: 'Á¶ªÊï£ÁÇπÔºàÊï¥Êï∞ÊúàÔºâ',
                            data: scatterData,
                            backgroundColor: '#f97316',
                            pointRadius: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: alpha,
                                    yMax: alpha,
                                    borderColor: '#ef4444',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        display: true,
                                        content: `Ê∏êËøëÁ∫ø M = Œ± = ${alpha.toFixed(6)}`,
                                        position: 'end'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Ë¥∑Ê¨æÊúüÈôê n (Êúà)'
                            },
                            min: 0,
                            max: 400
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Êúà‰æõÈ¢ùÔºàÂçï‰ΩçÊú¨ÈáëÔºâ'
                            },
                            min: 0
                        }
                    }
                }
            });
        }

        function generateErrorChart(annualRate) {
            const labels = [];
            const errorData = [];
            
            for (let n = 1; n <= 400; n++) {
                labels.push(n);
                const discrete = calculateDiscretePayment(1, annualRate, n);
                const exponential = calculateExponentialApprox(1, annualRate, n);
                errorData.push(((discrete - exponential) / discrete) * 100);
            }
            
            const ctx = document.getElementById('errorChart');
            
            if (errorChart) {
                errorChart.destroy();
            }
            
            errorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Áõ∏ÂØπËØØÂ∑Æ',
                        data: errorData,
                        borderColor: '#f59e0b',
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Ë¥∑Ê¨æÊúüÈôê n (Êúà)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Áõ∏ÂØπËØØÂ∑Æ (%)'
                            }
                        }
                    }
                }
            });
        }

        function generateComparisonTable(annualRate) {
            let html = '<thead><tr><th>ÊúüÊï∞ n</th><th>Á¶ªÊï£ÂÖ¨Âºè</th><th>ÊåáÊï∞Ëøë‰ºº</th><th>ËøûÁª≠Ê®°Âûã</th><th>Áõ∏ÂØπËØØÂ∑Æ</th></tr></thead><tbody>';
            
            [12, 60, 120, 240, 360].forEach(n => {
                const discrete = calculateDiscretePayment(1, annualRate, n);
                const exponential = calculateExponentialApprox(1, annualRate, n);
                const continuous = calculateContinuousPayment(1, annualRate, n);
                const error = ((discrete - exponential) / discrete * 100);
                
                html += `<tr>
                    <td>${n} (${(n/12).toFixed(1)}Âπ¥)</td>
                    <td class="font-mono">${discrete.toFixed(6)}</td>
                    <td class="font-mono">${exponential.toFixed(6)}</td>
                    <td class="font-mono">${continuous.toFixed(6)}</td>
                    <td class="font-mono" style="color: #ea580c;">${error.toFixed(4)}%</td>
                </tr>`;
            });
            
            html += '</tbody>';
            document.getElementById('comparisonTable').innerHTML = html;
        }

        function generateDerivativeChart(annualRate) {
            const labels = [];
            const derivativeData = [];
            const yearlyData = [];
            
            for (let years = 5; years <= 50; years++) {
                const n = years * 12;
                const M_current = calculateExponentialApprox(1, annualRate, n);
                const M_next = calculateExponentialApprox(1, annualRate, n + 12);
                const derivative = Math.abs((M_current - M_next) * 1000);
                
                labels.push(years);
                derivativeData.push(derivative);
                yearlyData.push({ years, derivative });
            }
            
            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const range1 = yearlyData.filter(d => d.years >= 5 && d.years <= 30);
            const range2 = yearlyData.filter(d => d.years > 30);
            const avgDerivative1 = range1.reduce((sum, d) => sum + d.derivative, 0) / range1.length;
            const avgDerivative2 = range2.reduce((sum, d) => sum + d.derivative, 0) / range2.length;
            const ratio = avgDerivative1 / avgDerivative2;
            
            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
            document.getElementById('derivativeStats').innerHTML = `
                <div>
                    <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 4px; margin-bottom: 8px;">
                        <span class="text-sm">5-30Âπ¥Âπ≥ÂùáÂèòÂåñÁéáÔºö</span>
                        <span class="font-mono font-bold" style="color: #2563eb;">${avgDerivative1.toFixed(6)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 4px; margin-bottom: 8px;">
                        <span class="text-sm">30-50Âπ¥Âπ≥ÂùáÂèòÂåñÁéáÔºö</span>
                        <span class="font-mono font-bold" style="color: #ea580c;">${avgDerivative2.toFixed(6)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px; background: linear-gradient(to right, #fef3c7, #fde68a); border-radius: 4px; border: 1px solid #fbbf24;">
                        <span class="font-semibold text-sm">Ë°∞ÂáèÊØî‰æãÔºö</span>
                        <span class="font-mono font-bold" style="color: #b91c1c;">${ratio.toFixed(2)}ÂÄç</span>
                    </div>
                </div>
                <p class="text-xs text-gray-600" style="margin-top: 12px;">
                    ÂâçÊúüÂèòÂåñÁéáÊòØÂêéÊúüÁöÑ <strong>${ratio.toFixed(1)}ÂÄç</strong>ÔºåËØ¥ÊòéÂâç30Âπ¥Âª∂ÈïøÊúüÈôêÁöÑÊïàÊûúËøúÂ•Ω‰∫é30Âπ¥Âêé„ÄÇ
                </p>
            `;
            
            const ctx = document.getElementById('derivativeChart');
            
            if (derivativeChart) {
                derivativeChart.destroy();
            }
            
            derivativeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ÂèòÂåñÁéá |dM/d(Âπ¥)|',
                        data: derivativeData,
                        borderColor: '#8b5cf6',
                        borderWidth: 3,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    xMin: 30,
                                    xMax: 30,
                                    borderColor: '#ef4444',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        display: true,
                                        content: '30Âπ¥ÂàÜÁïåÁ∫ø',
                                        position: 'start'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Ë¥∑Ê¨æÊúüÈôêÔºàÂπ¥Ôºâ'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ÊØèÂ¢ûÂä†1Âπ¥ÔºåÊúà‰æõÂáèÂ∞ëÈ¢ù (√ó1000)'
                            }
                        }
                    }
                }
            });
        }

        function generateComparisonCards(principal, annualRate) {
            const p1020 = calculateExponentialApprox(principal, annualRate, 120);
            const p2030 = calculateExponentialApprox(principal, annualRate, 240);
            const p3040a = calculateExponentialApprox(principal, annualRate, 360);
            const p3040b = calculateExponentialApprox(principal, annualRate, 480);
            
            document.getElementById('comparison1020').innerHTML = `
                <p class="text-sm font-semibold" style="color: #065f46; margin-bottom: 8px;">üìä 10Âπ¥ ‚Üí 20Âπ¥</p>
                <p class="text-xs text-gray-700">
                    Êúà‰æõ‰ªé ${p1020.toFixed(2)} ÂÖÉÈôçËá≥ ${p2030.toFixed(2)} ÂÖÉ
                </p>
                <p class="font-bold" style="color: #047857; font-size: 18px; margin-top: 8px;">
                    ÂáèÂ∞ë ${(p1020 - p2030).toFixed(2)} ÂÖÉ
                </p>
            `;
            
            document.getElementById('comparison2030').innerHTML = `
                <p class="text-sm font-semibold" style="color: #92400e; margin-bottom: 8px;">üìä 20Âπ¥ ‚Üí 30Âπ¥</p>
                <p class="text-xs text-gray-700">
                    Êúà‰æõ‰ªé ${p2030.toFixed(2)} ÂÖÉÈôçËá≥ ${p3040a.toFixed(2)} ÂÖÉ
                </p>
                <p class="font-bold" style="color: #b45309; font-size: 18px; margin-top: 8px;">
                    ÂáèÂ∞ë ${(p2030 - p3040a).toFixed(2)} ÂÖÉ
                </p>
            `;
            
            document.getElementById('comparison3040').innerHTML = `
                <p class="text-sm font-semibold" style="color: #991b1b; margin-bottom: 8px;">üìä 30Âπ¥ ‚Üí 40Âπ¥</p>
                <p class="text-xs text-gray-700">
                    Êúà‰æõ‰ªé ${p3040a.toFixed(2)} ÂÖÉÈôçËá≥ ${p3040b.toFixed(2)} ÂÖÉ
                </p>
                <p class="font-bold" style="color: #b91c1c; font-size: 18px; margin-top: 8px;">
                    ‰ªÖÂáèÂ∞ë ${(p3040a - p3040b).toFixed(2)} ÂÖÉ
                </p>
            `;
        }

        function generateMathExplanation(alpha) {
            const container = document.getElementById('mathExplanation');
            container.innerHTML = `
                <p class="font-semibold text-sm" style="margin-bottom: 8px;">üî¨ Êï∞Â≠¶Ëß£Èáä</p>
                <div class="text-sm text-gray-700">
                    <p>ÂØπ‰∫éÂáΩÊï∞ <span id="func1"></span>ÔºåÂÖ∂ÂØºÊï∞‰∏∫Ôºö</p>
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; margin: 8px 0;" id="derivative"></div>
                    <p>ÂΩì n Â¢ûÂ§ßÊó∂Ôºå<span id="exp1"></span>ÔºåÂØºËá¥ <span id="exp2"></span>„ÄÇËøôÂ∞±ÊòØ‰∏∫‰ªÄ‰πàÊõ≤Á∫øË∂äÊù•Ë∂äÂπ≥ÁºìÔºåÂª∂ÈïøÊúüÈôêÁöÑÊïàÊûúË∂äÊù•Ë∂äÂ∑Æ„ÄÇ</p>
                    <p style="color: #b91c1c; font-weight: 600; margin-top: 12px;">
                        ÁªìËÆ∫ÔºöË∂ÖËøá30Âπ¥ÁöÑË¥∑Ê¨æÔºåÊúà‰æõËôΩÁÑ∂Áï•‰ΩéÔºå‰ΩÜÁî±‰∫éÊúüÈôêËøáÈïø„ÄÅÊÄªÂà©ÊÅØÂ∑®Â§ßÔºåÂÆûË¥®‰∏äÂèòÊàê‰∫Ü"Ê∞∏Áª≠ÂÄ∫"ÔºåË¥∑Ê¨æ‰∫∫Âá†‰πé‰∏ÄËæàÂ≠êÈÉΩÂú®ËøòÂà©ÊÅØ„ÄÇ
                    </p>
                </div>
            `;
            
            renderLatex(document.getElementById('func1'), 'M(n) = P \\cdot \\frac{\\alpha}{1 - e^{-\\alpha n}}');
            renderLatex(document.getElementById('derivative'), '\\frac{dM}{dn} = -P \\cdot \\frac{\\alpha^2 e^{-\\alpha n}}{(1 - e^{-\\alpha n})^2}', true);
            renderLatex(document.getElementById('exp1'), 'e^{-\\alpha n} \\to 0');
            renderLatex(document.getElementById('exp2'), '|dM/dn| \\to 0');
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        window.addEventListener('load', init);
    </script>
</body>
</html>
